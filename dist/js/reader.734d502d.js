(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["reader"],{"0954":function(t,e,i){"use strict";i("8a19")},"095a":function(t,e,i){"use strict";i("b009")},"129f":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"27a3":function(t,e,i){},"320d":function(t,e,i){},"394a":function(t,e,i){},"48b1":function(t,e,i){"use strict";i("27a3")},4998:function(t,e,i){"use strict";i("be21")},6212:function(t,e,i){"use strict";i("394a")},"6dc9":function(t,e,i){"use strict";i("8506")},"841c":function(t,e,i){"use strict";var o=i("c65b"),n=i("d784"),s=i("825a"),a=i("1d80"),r=i("129f"),c=i("577e"),l=i("dc4a"),h=i("14c3");n("search",(function(t,e,i){return[function(e){var i=a(this),n=void 0==e?void 0:l(e,t);return n?o(n,e,i):new RegExp(e)[t](c(i))},function(t){var o=s(this),n=c(t),a=i(e,o,n);if(a.done)return a.value;var l=o.lastIndex;r(l,0)||(o.lastIndex=0);var u=h(o,n);return r(o.lastIndex,l)||(o.lastIndex=l),null===u?-1:u.index}]}))},8506:function(t,e,i){},"873c":function(t,e,i){"use strict";i("a779")},"8a19":function(t,e,i){},"8efd":function(t,e,i){"use strict";var o=i("53ca"),n=function(t,e,i,o){return t/=o/2,t<1?i/2*t*t+e:(t--,-i/2*(t*(t-2)-1)+e)},s=function(){var t,e,i,s,a,r,c,l,h,u,d,g,f;function p(){var e=t.scrollTop||t.scrollY||t.pageYOffset;return e="undefined"===typeof e?0:e,e}function m(e){var o=e.getBoundingClientRect().top,n=t.getBoundingClientRect?t.getBoundingClientRect().top:0;return o-n+i}function C(e){t.scrollTo?t.scrollTo(0,e):t.scrollTop=e}function v(t){u||(u=t),d=t-u,g=r(d,i,l,h),C(g),d<h?requestAnimationFrame(v):b()}function b(){C(i+l),e&&c&&(e.setAttribute("tabindex","-1"),e.focus()),"function"===typeof f&&f(),u=!1}function k(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(h=d.duration||1e3,a=d.offset||0,f=d.callback,r=d.easing||n,c=d.a11y||!1,Object(o["a"])(d.container)){case"object":t=d.container;break;case"string":t=document.querySelector(d.container);break;default:t=window}switch(i=p(),Object(o["a"])(u)){case"number":e=void 0,c=!1,s=i+u;break;case"object":e=u,s=m(e);break;case"string":e=document.querySelector(u),s=m(e);break}switch(l=s-i+a,Object(o["a"])(d.duration)){case"number":h=d.duration;break;case"function":h=d.duration(l);break}requestAnimationFrame(v)}return k},a=s();e["a"]=a},"968f":function(t,e,i){"use strict";i.r(e);var o,n,s,a,r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"chapterWrapperRef",staticClass:"chapter-wrapper",class:{night:t.isNight,day:!t.isNight,"mini-interface":t.$store.state.miniInterface},style:t.bodyTheme},[i("div",{staticClass:"tool-bar",style:t.leftBarTheme},[i("div",{staticClass:"tools"},[i("el-popover",{attrs:{placement:"right",width:t.popperWidth,trigger:"click","visible-arrow":!1,"popper-class":"popper-component"},model:{value:t.popBookShelfVisible,callback:function(e){t.popBookShelfVisible=e},expression:"popBookShelfVisible"}},[i("BookShelf",{ref:"popBookShelf",staticClass:"popup",attrs:{visible:t.popBookShelfVisible},on:{changeBook:t.changeBook,toShelf:t.toShelf}}),i("div",{staticClass:"tool-icon",attrs:{slot:"reference"},slot:"reference"},[i("div",{staticClass:"iconfont"},[t._v("  ")]),i("div",{staticClass:"icon-text"},[t._v("书架")])])],1),i("el-popover",{attrs:{placement:"right",width:t.popperWidth,trigger:"click","visible-arrow":!1,"popper-class":"popper-component"},model:{value:t.popBookSourceVisible,callback:function(e){t.popBookSourceVisible=e},expression:"popBookSourceVisible"}},[i("BookSource",{ref:"popBookSource",staticClass:"popup",attrs:{visible:t.popBookSourceVisible},on:{changeBookSource:function(e){return t.changeBookSource()},close:function(e){t.popBookSourceVisible=!1}}}),i("div",{staticClass:"tool-icon",attrs:{slot:"reference"},slot:"reference"},[i("div",{staticClass:"tool-el-icon"},[i("i",{staticClass:"el-icon-menu"})]),i("div",{staticClass:"icon-text"},[t._v("书源")])])],1),i("el-popover",{attrs:{placement:"right",width:t.popperWidth,trigger:"click","visible-arrow":!1,"popper-class":"popper-component"},model:{value:t.popCataVisible,callback:function(e){t.popCataVisible=e},expression:"popCataVisible"}},[i("PopCata",{ref:"popCata",staticClass:"popup",attrs:{visible:t.popCataVisible},on:{getContent:t.getContent,refresh:t.refreshCatalog,close:function(e){t.popCataVisible=!1}}}),i("div",{staticClass:"tool-icon",attrs:{slot:"reference"},slot:"reference"},[i("div",{staticClass:"iconfont"},[t._v("  ")]),i("div",{staticClass:"icon-text"},[t._v("目录")])])],1),i("el-popover",{attrs:{placement:"right",width:t.popperWidth,trigger:"click","visible-arrow":!1,"popper-class":"popper-component"},model:{value:t.readSettingsVisible,callback:function(e){t.readSettingsVisible=e},expression:"readSettingsVisible"}},[i("ReadSettings",{staticClass:"popup",attrs:{visible:t.readSettingsVisible},on:{close:function(e){t.readSettingsVisible=!1},showClickZone:function(e){t.showClickZone=!0},readMethodChange:t.beforeReadMethodChange}}),i("div",{staticClass:"tool-icon",attrs:{slot:"reference"},slot:"reference"},[i("div",{staticClass:"iconfont"},[t._v("  ")]),i("div",{staticClass:"icon-text"},[t._v("设置")])])],1),i("div",{staticClass:"tool-icon",style:t.$store.state.miniInterface?{order:-1}:{},on:{click:t.toShelf}},[i("div",{staticClass:"iconfont"},[t._v("  ")]),i("div",{staticClass:"icon-text"},[t._v("首页")])]),t.$store.state.miniInterface?t._e():i("div",{staticClass:"tool-icon",on:{click:function(e){return t.toTop(0)}}},[i("div",{staticClass:"iconfont"},[t._v("  ")]),i("div",{staticClass:"icon-text"},[t._v("顶部")])]),t.$store.state.miniInterface?t._e():i("div",{staticClass:"tool-icon",on:{click:function(e){return t.toBottom(0)}}},[i("div",{staticClass:"iconfont"},[t._v("  ")]),i("div",{staticClass:"icon-text"},[t._v("底部")])])],1)]),i("div",{staticClass:"read-bar",style:t.rightBarTheme},[i("div",{staticClass:"float-btn-zone"},[i("div",{staticClass:"float-left-btn-zone"},[i("div",{staticClass:"float-btn",style:t.popupAbsoluteBtnStyle,on:{click:t.showBookmarkDialog}},[i("i",{staticClass:"el-icon-collection-tag"})]),i("div",{staticClass:"float-btn",style:t.popupAbsoluteBtnStyle,on:{click:t.showSearchBookContentDialog}},[i("i",{staticClass:"el-icon-search"})]),i("div",{staticClass:"float-btn",style:t.popupAbsoluteBtnStyle,on:{click:t.showReadingBookInfo}},[i("i",{staticClass:"el-icon-info"})]),t.$store.state.miniInterface?i("div",{staticClass:"float-btn",style:t.popupAbsoluteBtnStyle,on:{click:function(e){return t.toTop(0)}}},[i("i",{staticClass:"el-icon-top"})]):t._e(),t.$store.state.miniInterface?i("div",{staticClass:"float-btn",style:t.popupAbsoluteBtnStyle,on:{click:function(e){return t.toBottom(0)}}},[i("i",{staticClass:"el-icon-bottom"})]):t._e()]),i("div",{staticClass:"float-right-btn-zone"},[i("div",{staticClass:"float-btn",style:t.popupAbsoluteBtnStyle,on:{click:t.refreshContent}},[i("i",{staticClass:"el-icon-refresh-right"})]),t.isEpub||t.isCarToon||t.isAudio?t._e():i("div",{staticClass:"float-btn",style:t.popupAbsoluteBtnStyle,on:{click:function(e){return t.toggleAutoReading()}}},[i("i",{staticClass:"el-icon-view"})]),!t.speechAvalable||t.isEpub||t.isCarToon||t.isAudio?t._e():i("div",{staticClass:"float-btn",style:t.popupAbsoluteBtnStyle,on:{click:function(e){t.showReadBar=!t.showReadBar}}},[i("i",{staticClass:"el-icon-headset"})]),i("div",{staticClass:"float-btn",style:t.popupAbsoluteBtnStyle,on:{click:t.toogleNight}},[t.isNight?i("i",{staticClass:"el-icon-sunny"}):i("i",{staticClass:"el-icon-moon"})])])]),t.$store.state.miniInterface&&!t.isAudio?i("div",{staticClass:"progress"},[i("div",{staticClass:"progress-bar"},[i("el-slider",{attrs:{min:1,max:t.totalPages,"show-tooltip":!1},on:{change:t.showPage,input:function(e){t.progressValue=e}},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1),i("span",{staticClass:"progress-tip"},[t._v(t._s(t.formatProgressTip()))])]):t._e(),t.showCacheContentZone?i("div",{staticClass:"cache-content-zone"},[i("div",[t._v(" 缓存章节 ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isCachingContent,expression:"!isCachingContent"}],staticClass:"cache-content-btn",on:{click:function(e){return t.cacheChapterContent(50)}}},[t._v(" 后面50章 ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isCachingContent,expression:"!isCachingContent"}],staticClass:"cache-content-btn",on:{click:function(e){return t.cacheChapterContent(100)}}},[t._v(" 后面100章 ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isCachingContent,expression:"!isCachingContent"}],staticClass:"cache-content-btn",on:{click:function(e){return t.cacheChapterContent(!0)}}},[t._v(" 后面全部 ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isCachingContent,expression:"isCachingContent"}],staticClass:"caching-tip"},[t._v(" "+t._s(t.cachingContentTip)+" ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isCachingContent,expression:"isCachingContent"}],staticClass:"caching-cancel-btn",on:{click:t.cancelCaching}},[i("i",{staticClass:"el-icon-close"})])]):t._e(),i("div",{staticClass:"tools"},[i("div",{staticClass:"tool-icon progress-text",on:{click:t.showCacheContent}},[t.$store.state.miniInterface?i("span",[t._v("阅读进度: ")]):t._e(),t._v(" "+t._s(t.readingProgress)+" ")]),i("div",{staticClass:"tool-icon",style:t.$store.state.miniInterface?{order:-1}:{},on:{click:function(e){return t.toLastChapter()}}},[i("div",{staticClass:"iconfont"},[t._v("  ")]),t.$store.state.miniInterface?i("span",[t._v("上一章")]):t._e()]),i("div",{staticClass:"tool-icon",on:{click:function(e){return t.toNextChapter()}}},[t.$store.state.miniInterface?i("span",[t._v("下一章")]):t._e(),i("div",{staticClass:"iconfont"},[t._v("  ")])])])]),i("div",{staticClass:"read-bar",style:t.readBarTheme},[i("div",{staticClass:"reader-bar-inner"},[i("div",{staticClass:"operate-bar"},[i("div",{staticClass:"close-btn",on:{click:t.exitRead}},[i("i",{staticClass:"el-icon-close"})]),i("div",{staticClass:"center"},[i("span",{staticClass:"ctrl-btn",on:{click:t.speechPrev}},[t._v("上一段")]),i("span",{staticClass:"play-pause-btn",on:{click:t.toggleSpeech}},[t.speechSpeaking?i("i",{staticClass:"el-icon-video-pause",style:t.popupAbsoluteBtnStyle}):i("i",{staticClass:"el-icon-video-play",style:t.popupAbsoluteBtnStyle})]),i("span",{staticClass:"ctrl-btn",on:{click:t.speechNext}},[t._v("下一段")])]),i("div",{staticClass:"collapse-btn",on:{click:function(e){t.showSpeechConfig=!t.showSpeechConfig}}},[t.showSpeechConfig?i("i",{staticClass:"el-icon-bottom"}):i("i",{staticClass:"el-icon-top"})])]),t.showSpeechConfig?i("div",{staticClass:"setting-item"},[i("div",{staticClass:"setting-title"},[t._v("语音库")]),i("div",{staticClass:"setting-value"},[i("div",{staticClass:"voice-list"},[i("el-radio-group",{staticClass:"radio-group",attrs:{size:"small"},model:{value:t.voiceName,callback:function(e){t.voiceName=e},expression:"voiceName"}},t._l(t.voiceList,(function(t,e){return i("el-radio-button",{key:e,staticClass:"radio-button",attrs:{label:t.name}})})),1)],1)])]):t._e(),t.showSpeechConfig?i("div",{staticClass:"setting-item"},[i("div",{staticClass:"setting-title"},[t._v("语音设置")]),i("div",{staticClass:"setting-value"},[i("div",{staticClass:"progress"},[i("span",{staticClass:"progress-tip"},[t._v("语速")]),i("div",{staticClass:"progress-bar"},[i("el-slider",{attrs:{min:.5,max:2,step:.1,"show-tooltip":!1},on:{change:t.changeSpeechRate},model:{value:t.speechRate,callback:function(e){t.speechRate=e},expression:"speechRate"}})],1),i("span",{staticClass:"setting-btn",on:{click:function(e){return t.changeSpeechRate(1)}}},[t._v("重置")])]),i("div",{staticClass:"progress"},[i("span",{staticClass:"progress-tip"},[t._v("语调")]),i("div",{staticClass:"progress-bar"},[i("el-slider",{attrs:{min:0,max:2,step:.1,"show-tooltip":!1},on:{change:t.changeSpeechPitch},model:{value:t.speechPitch,callback:function(e){t.speechPitch=e},expression:"speechPitch"}})],1),i("span",{staticClass:"setting-btn",on:{click:function(e){return t.changeSpeechPitch(1)}}},[t._v("重置")])]),i("div",{staticClass:"progress"},[i("span",{staticClass:"progress-tip"},[t._v("定时")]),i("div",{staticClass:"progress-bar"},[i("el-slider",{attrs:{min:0,max:180,step:1,"show-tooltip":!1},on:{change:t.changeSpeechMinutes},model:{value:t.speechMinutes,callback:function(e){t.speechMinutes=e},expression:"speechMinutes"}})],1),i("span",{staticClass:"setting-btn"},[t._v(t._s(t.speechMinutes)+"分钟")])])])]):t._e()])]),i("div",{ref:"content",staticClass:"chapter",class:t.chapterClass,style:t.chapterTheme},[t.showClickZone?i("div",{staticClass:"click-zone",style:t.isSlideRead?{}:{position:"fixed"}},[i("div",{style:t.showPrevPageStyle},[i("span",[t._v("点击前一页")])]),i("div",{style:t.showMenuZoneStyle},[i("span",[t._v("点击显示菜单")])]),i("div",{style:t.showNextPageStyle},[i("span",[t._v("点击后一页")])]),i("div",{staticClass:"close-btn",on:{click:function(e){t.showClickZone=!1}}},[t._v("关闭")])]):t._e(),i("div",{ref:"top",staticClass:"top-bar"},[t._v(" "+t._s(t.$store.state.miniInterface?t.title:"")+" ")]),i("div",{staticClass:"content",on:{touchstart:t.handleTouchStart,touchmove:t.handleTouchMove,touchend:t.handleTouchEnd,click:t.handlerClick}},[t.show?i("div",{staticClass:"content-inner"},[i("Content",{ref:"bookContentRef",staticClass:"book-content",style:t.contentStyle,attrs:{title:t.title,content:t.content,showContent:t.show,error:t.error,showChapterList:t.showChapterList,isScrollRead:t.isScrollRead},on:{prevChapter:t.toLastChapter,nextChapter:t.toNextChapter,updateProgress:t.saveReadingPosition,iframeLoad:function(e){return t.$emit("iframeLoad")},contentChange:function(e){return t.computePages()},epubClick:t.eventHandler,epubLocationChange:t.epubLocationChangeHandler,epubClickHash:t.epubClickHash,epubKeydown:function(e){return t.keydownHandler(e,!0)}}})],1):t._e()]),i("div",{ref:"bottom",staticClass:"bottom-bar"},[t.isSlideRead?i("span",[t._v(t._s("第"+t.currentPage+"/"+t.totalPages+"页 "+t.readingProgress))]):t._e(),t.isSlideRead?i("span",[t._v(t._s(t.timeStr))]):t._e(),!t.show||t.isSlideRead||t.error||t.isScrollRead?t._e():i("span",{staticClass:"bottom-btn",on:{click:function(e){return t.toNextChapter()}}},[t._v("加载下一章")])])])])},c=[],l=i("c7eb"),h=i("1da1"),u=i("5530"),d=(i("b0c0"),i("4795"),i("e25e"),i("c975"),i("8a79"),i("cca6"),i("d401"),i("0d03"),i("d3b7"),i("25f0"),i("ac1f"),i("841c"),i("4160"),i("159b"),i("1276"),i("5319"),i("4d63"),i("c607"),i("2c3e"),i("e260"),i("3ca3"),i("ddb0"),i("c0b6"),i("99af"),i("4e82"),i("2ca0"),i("7db0"),i("fb6a"),i("4de4"),i("d81d"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"popup-wrapper",style:t.popupTheme},[i("div",{staticClass:"title-zone"},[i("div",{staticClass:"title"},[t._v(" 目录 "),t.catalog.length?i("span",[t._v("("+t._s(t.catalog.length)+")")]):t._e()]),i("div",{class:{"title-btn":!0}},[t.catalog.length?i("span",{staticClass:"span-btn",on:{click:function(e){t.asc=!t.asc}}},[t._v(t._s(t.asc?"倒序":"顺序"))]):t._e(),t.catalog.length?i("span",{staticClass:"span-btn",on:{click:t.toTop}},[t._v("顶部")]):t._e(),t.catalog.length?i("span",{staticClass:"span-btn",on:{click:t.toBottom}},[t._v("底部")]):t._e(),"loc_book"===t.book.origin?i("span",{staticClass:"span-btn",on:{click:t.changeRule}},[t._v(" 修改规则 ")]):t._e(),i("span",{class:{loading:t.refreshLoading,"refresh-btn":!0},on:{click:t.refreshChapter}},[t.refreshLoading?i("i",{staticClass:"el-icon-loading"}):t._e(),t._v(" "+t._s(t.refreshLoading?"刷新中...":"刷新")+" ")])])]),i("div",{ref:"cataData",staticClass:"data-wrapper",class:{night:t.$store.getters.isNight,day:!t.$store.getters.isNight}},[i("div",{staticClass:"cata"},t._l(t.cataList,(function(e,o){return i("div",{key:e.index,ref:"cata",refInFor:!0,staticClass:"log",class:{selected:t.isSelected(o)},on:{click:function(i){return t.gotoChapter(e)}}},[i("div",{class:{"log-text":!0,cached:t.cachedCataMap[e.index]}},[t._v(" "+t._s(e.title)+" ")])])})),0)])])}),g=[],f=(i("26e9"),i("8efd")),p=i("be3b"),m=i("2b0e"),C={name:"PopCata",data:function(){return{refreshLoading:!1,asc:!0,cachedCataMap:{},tocUrl:""}},props:["visible"],computed:{book:function(){return this.$store.getters.readingBook},index:function(){return this.$store.getters.readingBook.index},catalog:function(){return this.$store.getters.readingBook.catalog||[]},cataList:function(){return this.asc?this.catalog:[].concat(this.catalog).reverse()},theme:function(){return this.$store.getters.config.theme},popupTheme:function(){return{background:this.$store.getters.currentThemeConfig.popup}},tocRuleList:function(){return this.book&&this.book.originName?this.book.originName.toLowerCase().endsWith(".txt")?this.$store.state.txtTocRules:[{name:"根据 Spin 获取章节，使用 Toc 补充章节名",rule:"spin+toc"},{name:"根据 Spin 获取章节，强制使用 Toc 章节名",rule:"spin<toc"},{name:"根据 Spin 获取章节",rule:"spin"},{name:"根据 Toc 获取章节，使用 Spin 补充章节名",rule:"toc+spin"},{name:"根据 Toc 获取章节，强制使用 Spin 章节名",rule:"toc<spin"},{name:"根据 Toc 获取章节",rule:"toc"}]:[]}},mounted:function(){window.popcatalogComp=this},watch:{visible:function(t){var e=this;t&&(this.computeCachedCata(),this.$nextTick((function(){e.jumpToCurrent()})))},catalog:function(){this.refreshLoading=!1,this.computeCachedCata()},index:function(){this.computeCachedCata()},asc:function(){this.jumpToCurrent()}},methods:{isSelected:function(t){return this.asc?t==this.$store.getters.readingBook.index:this.catalog.length-1-t==this.$store.getters.readingBook.index},gotoChapter:function(t){var e=this.catalog.indexOf(t);this.$emit("close"),this.$emit("getContent",e)},refreshChapter:function(){this.refreshLoading=!0,this.$emit("refresh")},changeRule:function(){var t=this;return Object(h["a"])(Object(l["a"])().mark((function e(){var i,o;return Object(l["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$msgbox({title:"修改目录规则",message:t.renderComp(),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"})["catch"]((function(t){return"close"===t&&"close"}));case 2:if(i=e.sent,"confirm"!==i){e.next=12;break}if(t.tocUrl!==t.book.tocUrl){e.next=7;break}return t.$message.error("未修改规则"),e.abrupt("return");case 7:return o=t.$store.getters.shelfBooks.find((function(e){return e.bookUrl===t.book.bookUrl})),o.tocUrl=t.tocUrl,e.abrupt("return",p["a"].post(t.api+"/saveBook",o).then((function(e){e.data.isSuccess&&(t.$message.success("操作成功"),t.$store.commit("updateShelfBook",e.data.data),t.refreshLoading=!0,t.$emit("refresh"))}),(function(e){t.$message.error("操作失败"+(e&&e.toString()))})));case 12:return e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e)})))()},renderComp:function(){this.$createElement;var t=this.tocRuleList;this.tocUrl=this.book.tocUrl;var e=this;m["default"].component("custComp2",{render:function(){var e=this,i=arguments[0];return window.custComp2=this,i("div",{style:{textAlign:"center"}},[i("span",["请选择规则："]),i("el-select",{attrs:{size:"mini",filterable:!0,placeholder:"未分组"},model:{value:e.selectedRule,callback:function(t){e.selectedRule=t}},on:{change:this.change}},[t.map((function(t,e){return i("el-option",{key:"rule-"+e,attrs:{label:t.name,value:t.rule}})}))]),i("el-input",{attrs:{type:"textarea",rows:3,size:"small"},style:{marginTop:"10px"},model:{value:e.selectedRule,callback:function(t){e.selectedRule=t}},on:{change:this.change}})])},data:function(){return{selectedRule:e.tocUrl}},methods:{change:function(){e.tocUrl=this.selectedRule}}});var i=m["default"].component("custComp2");return this.$createElement(i)},jumpToCurrent:function(t){var e=this;if("undefined"===typeof t&&(t=this.asc?this.$store.getters.readingBook.index:this.catalog.length-1-this.$store.getters.readingBook.index),this.$refs.cata&&this.$refs.cata[t]){var i=this.$refs.cataData;Object(f["a"])(this.$refs.cata[t],{container:i,duration:0})}else setTimeout((function(){e.jumpToCurrent(t)}),10)},toTop:function(){this.jumpToCurrent(0)},toBottom:function(){this.jumpToCurrent(this.catalog.length-1)},computeCachedCata:function(){var t=this,e={},i="localCache@"+this.$store.getters.readingBook.name+"_"+this.$store.getters.readingBook.author+"@"+this.$store.getters.readingBook.bookUrl+"@chapterContent-";window.$cacheStorage.iterate((function(t,o){if(o.startsWith(i))try{var n=parseInt(o.replace(i,""));e[n]=!0}catch(s){}})).then((function(){t.cachedCataMap=e}))["catch"]((function(){}))}}},v=C,b=(i("6dc9"),i("2877")),k=Object(b["a"])(v,d,g,!1,null,"df442994",null),w=k.exports,S=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"settings-wrapper",class:{night:t.$store.getters.isNight,day:!t.$store.getters.isNight},style:t.popupTheme},[i("div",{staticClass:"settings-title"},[t._v(" 设置 "),i("div",{staticClass:"title-btn",on:{click:t.resetConfig}},[t._v("重置为默认配置")])]),i("div",{staticClass:"setting-list"},[i("ul",[i("li",[i("span",{staticClass:"setting-item-title"},[t._v("特殊模式")]),i("div",{staticClass:"selection-zone"},[t._l(t.pageTypes,(function(e,o){return i("span",{key:o,staticClass:"span-item",class:{selected:t.config.pageType==e},on:{click:function(i){return t.setPageType(e)}}},[t._v(t._s("Kindle"===e?"简洁":"正常"))])})),i("span",{staticClass:"small-tip"},[t._v("❗️开启简洁模式会关闭动画以及首页的部分功能")])],2)]),i("el-divider"),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("配置方案")]),i("div",{staticClass:"selection-zone"},[t._l(t.$store.state.customConfigList,(function(e,o){return i("span",{key:o,staticClass:"span-item",class:{selected:t.$store.getters.config.customConfig===e.name},on:{click:function(i){return t.setCustomConfig(e)}}},[i("span",[t._v(t._s(e.name))]),o>1&&t.$store.getters.config.customConfig!==e.name?i("i",{staticClass:"el-icon-close delete-custom-config-icon",on:{click:function(i){return i.stopPropagation(),t.deleteCustomConfig(o,e.name)}}}):t._e()])})),i("span",{key:"addNewCustomConfig",staticClass:"span-item",on:{click:t.addNewCustomConfig}},[t._v("新增方案")]),i("span",{key:"autoTheme",ref:"themes",staticClass:"span-item",class:{selected:t.$store.getters.config.autoTheme},on:{click:t.setAutoTheme}},[t._v("自动切换")])],2)]),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("方案类型")]),i("div",{staticClass:"selection-zone"},t._l(t.configDefaultTypeList,(function(e,o){return i("span",{key:o,staticClass:"span-item",class:{selected:t.currentCustomConfig.configDefaultType===e},on:{click:function(i){return t.setConfigDefaultType(e)}}},[t._v(t._s(e))])})),0)]),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("阅读主题")]),i("div",{staticClass:"selection-zone"},[t._l(t.themeColors,(function(e,o){return i("span",{key:o,ref:"themes",refInFor:!0,staticClass:"theme-item",class:{selected:t.config.theme===o},style:e,on:{click:function(e){return t.setConfig("theme",o)}}},[6!=o?i("em",{staticClass:"iconfont"},[t._v("")]):i("em",{staticClass:"moon-icon"},[t._v(t._s(t.moonIcon))])])})),i("span",{key:"custom",ref:"themes",staticClass:"span-item",class:{selected:"custom"===t.config.theme},on:{click:function(e){return t.setConfig("theme","custom")}}},[t._v("自定义")])],2)]),"custom"===t.config.theme?i("li",[i("span",{staticClass:"setting-item-title"},[t._v("自定义")]),i("div",{staticClass:"custom-theme"},[i("div",{staticClass:"custom-theme-title"},[i("span",{staticClass:"custom-theme-title"},[t._v("主题模式")]),t._l(t.themeTypes,(function(e,o){return i("span",{key:o,staticClass:"span-item",class:{selected:t.themeType==e},on:{click:function(i){return t.setConfig("themeType",e)}}},[t._v(t._s("day"===e?"白天":"黑夜"))])}))],2),i("span",{staticClass:"custom-theme-title"},[t._v("页面背景颜色 "),i("el-color-picker",{model:{value:t.config.bodyColor,callback:function(e){t.$set(t.config,"bodyColor",e)},expression:"config.bodyColor"}})],1),i("span",{staticClass:"custom-theme-title"},[t._v("浮窗背景颜色 "),i("el-color-picker",{model:{value:t.config.popupColor,callback:function(e){t.$set(t.config,"popupColor",e)},expression:"config.popupColor"}})],1),i("span",{staticClass:"custom-theme-title"},[t._v("阅读背景颜色 "),i("el-color-picker",{model:{value:t.config.contentColor,callback:function(e){t.$set(t.config,"contentColor",e)},expression:"config.contentColor"}})],1),i("span",{staticClass:"custom-theme-title"},[t._v("阅读背景图片 "),t._l(t.builtinBG,(function(e,o){return i("img",{key:o,staticClass:"content-bg-preview",class:{selected:t.$store.getters.config.contentBGImg==e.src},attrs:{src:e.src,alt:""},on:{click:function(i){return t.setBGImg(e.src)}}})})),t._l(t.$store.getters.config.customBGImgList||[],(function(e){return i("div",{key:e,staticClass:"content-bg-preview",class:{selected:t.$store.getters.config.contentBGImg==e}},[i("img",{attrs:{src:t.getCustomBGImgURL(e),alt:""},on:{click:function(i){return t.setBGImg(e)}}}),i("i",{staticClass:"el-icon-close delete-bg-icon",on:{click:function(i){return i.stopPropagation(),t.deleteCustomBGImg(e)}}})])})),i("span",{staticClass:"upload-bg-btn",on:{click:t.uploadBGFile}},[t._v("上传")]),i("input",{ref:"bgFileRef",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:t.onBGFileChange}})],2)])]):t._e(),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("正文字体")]),i("div",{staticClass:"selection-zone"},[t._l(t.fonts,(function(e,o){return i("span",{key:o,staticClass:"span-item",class:{selected:t.config.font==o},on:{click:function(e){return t.setConfig("font",o)}}},[t._v(t._s(e)+" "),i("i",{class:{"el-icon-upload":!0,"upload-font-icon":!0,active:t.config.customFontsMap&&t.config.customFontsMap[t.customFonts[o]]},on:{click:function(i){return i.stopPropagation(),t.uploadFontFile(t.customFonts[o],e)}}})])})),i("input",{ref:"fontFileRef",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:t.onFontFileChange}})],2)]),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("简繁转换")]),i("div",{staticClass:"selection-zone"},t._l(t.chineseFonts,(function(e,o){return i("span",{key:o,staticClass:"span-item",class:{selected:t.config.chineseFont==e},on:{click:function(i){return t.setConfig("chineseFont",e)}}},[t._v(t._s(e))])})),0)]),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("字体大小")]),i("div",{staticClass:"resize"},[i("span",{staticClass:"less",on:{click:function(e){return t.decConfig("fontSize")}}},[i("em",{staticClass:"iconfont"},[t._v("")])]),i("b"),i("span",{staticClass:"lang"},[i("el-input",{staticClass:"setting-input",attrs:{size:"mini"},model:{value:t.config.fontSize,callback:function(e){t.$set(t.config,"fontSize",e)},expression:"config.fontSize"}})],1),i("b"),i("span",{staticClass:"more",on:{click:function(e){return t.incConfig("fontSize")}}},[i("em",{staticClass:"iconfont"},[t._v("")])])])]),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("字体粗细")]),i("div",{staticClass:"resize"},[i("span",{staticClass:"less",on:{click:function(e){return t.decConfig("fontWeight")}}},[i("i",{staticClass:"el-icon-minus"})]),i("b"),i("span",{staticClass:"lang"},[i("el-input",{staticClass:"setting-input",attrs:{size:"mini"},model:{value:t.config.fontWeight,callback:function(e){t.$set(t.config,"fontWeight",e)},expression:"config.fontWeight"}})],1),i("b"),i("span",{staticClass:"less",on:{click:function(e){return t.incConfig("fontWeight")}}},[i("i",{staticClass:"el-icon-plus"})])])]),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("段落行高")]),i("div",{staticClass:"resize"},[i("span",{staticClass:"less",on:{click:function(e){return t.decConfig("lineHeight")}}},[i("i",{staticClass:"el-icon-minus"})]),i("b"),i("span",{staticClass:"lang"},[i("el-input",{staticClass:"setting-input",attrs:{size:"mini"},model:{value:t.config.lineHeight,callback:function(e){t.$set(t.config,"lineHeight",e)},expression:"config.lineHeight"}})],1),i("b"),i("span",{staticClass:"less",on:{click:function(e){return t.incConfig("lineHeight")}}},[i("i",{staticClass:"el-icon-plus"})])])]),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("段落间距")]),i("div",{staticClass:"resize"},[i("span",{staticClass:"less",on:{click:function(e){return t.decConfig("paragraphSpace")}}},[i("i",{staticClass:"el-icon-minus"})]),i("b"),i("span",{staticClass:"lang"},[i("el-input",{staticClass:"setting-input",attrs:{size:"mini"},model:{value:t.config.paragraphSpace,callback:function(e){t.$set(t.config,"paragraphSpace",e)},expression:"config.paragraphSpace"}})],1),i("b"),i("span",{staticClass:"less",on:{click:function(e){return t.incConfig("paragraphSpace")}}},[i("i",{staticClass:"el-icon-plus"})])])]),t.$store.state.miniInterface?i("li",[i("span",{staticClass:"setting-item-title"},[t._v("左右边距")]),i("div",{staticClass:"resize"},[i("span",{staticClass:"less",on:{click:function(e){return t.decConfig("horizontalPadding")}}},[i("i",{staticClass:"el-icon-minus"})]),i("b"),i("span",{staticClass:"lang"},[i("el-input",{staticClass:"setting-input",attrs:{size:"mini"},model:{value:t.config.horizontalPadding,callback:function(e){t.$set(t.config,"horizontalPadding",e)},expression:"config.horizontalPadding"}})],1),i("b"),i("span",{staticClass:"less",on:{click:function(e){return t.incConfig("horizontalPadding")}}},[i("i",{staticClass:"el-icon-plus"})])])]):t._e(),t.$store.state.miniInterface?i("li",[i("span",{staticClass:"setting-item-title"},[t._v("顶部边距")]),i("div",{staticClass:"resize"},[i("span",{staticClass:"less",on:{click:function(e){return t.decConfig("topPadding")}}},[i("i",{staticClass:"el-icon-minus"})]),i("b"),i("span",{staticClass:"lang"},[i("el-input",{staticClass:"setting-input",attrs:{size:"mini"},model:{value:t.config.topPadding,callback:function(e){t.$set(t.config,"topPadding",e)},expression:"config.topPadding"}})],1),i("b"),i("span",{staticClass:"less",on:{click:function(e){return t.incConfig("topPadding")}}},[i("i",{staticClass:"el-icon-plus"})])])]):t._e(),t.$store.state.miniInterface?i("li",[i("span",{staticClass:"setting-item-title"},[t._v("底部边距")]),i("div",{staticClass:"resize"},[i("span",{staticClass:"less",on:{click:function(e){return t.decConfig("bottomPadding")}}},[i("i",{staticClass:"el-icon-minus"})]),i("b"),i("span",{staticClass:"lang"},[i("el-input",{staticClass:"setting-input",attrs:{size:"mini"},model:{value:t.config.bottomPadding,callback:function(e){t.$set(t.config,"bottomPadding",e)},expression:"config.bottomPadding"}})],1),i("b"),i("span",{staticClass:"less",on:{click:function(e){return t.incConfig("bottomPadding")}}},[i("i",{staticClass:"el-icon-plus"})])])]):t._e(),i("li",[i("span",{staticClass:"setting-item-title font-color-title"},[t._v("字体颜色")]),i("el-color-picker",{model:{value:t.config.fontColor,callback:function(e){t.$set(t.config,"fontColor",e)},expression:"config.fontColor"}})],1),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("页面模式")]),i("div",{staticClass:"selection-zone"},t._l(t.pageModes,(function(e,o){return i("span",{key:o,staticClass:"span-item",class:{selected:t.config.pageMode==e},on:{click:function(i){return t.setPageMode(e)}}},[t._v(t._s(e))])})),0)]),t.$store.state.miniInterface?t._e():i("li",[i("span",{staticClass:"setting-item-title"},[t._v("页面宽度")]),i("div",{staticClass:"resize"},[i("span",{staticClass:"less",on:{click:function(e){return t.decConfig("readWidth")}}},[i("em",{staticClass:"iconfont"},[t._v("")])]),i("b"),t._v(" "),i("span",{staticClass:"lang"},[t._v(t._s(t.config.readWidth))]),i("b"),i("span",{staticClass:"more",on:{click:function(e){return t.incConfig("readWidth")}}},[i("em",{staticClass:"iconfont"},[t._v("")])])])]),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("翻页方式")]),i("div",{staticClass:"selection-zone"},[t._l(t.readMethods,(function(e,o){return i("span",{directives:[{name:"show",rawName:"v-show",value:!t.$store.state.miniInterface&&"左右滑动"!==e||t.$store.state.miniInterface,expression:"\n              (!$store.state.miniInterface && method !== '左右滑动') ||\n                $store.state.miniInterface\n            "}],key:o,staticClass:"span-item",class:{selected:t.config.readMethod==e},on:{click:function(i){return t.setReadMethod(e)}}},[t._v(t._s(e))])})),i("span",{staticClass:"small-tip"},[t._v("❗️上下滚动2会自动隐藏看过的章节，但是可能会抖动")])],2)]),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("动画时长")]),i("div",{staticClass:"resize"},[i("span",{staticClass:"less",on:{click:function(e){return t.decConfig("animateMSTime")}}},[i("i",{staticClass:"el-icon-minus"})]),i("b"),i("span",{staticClass:"lang"},[i("el-input",{staticClass:"setting-input",attrs:{size:"mini"},model:{value:t.config.animateMSTime,callback:function(e){t.$set(t.config,"animateMSTime",e)},expression:"config.animateMSTime"}})],1),i("b"),i("span",{staticClass:"less",on:{click:function(e){return t.incConfig("animateMSTime")}}},[i("i",{staticClass:"el-icon-plus"})])])]),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("自动翻页")]),i("div",{staticClass:"selection-zone"},t._l(t.autoReadingMethods,(function(e,o){return i("span",{key:o,staticClass:"span-item",class:{selected:t.config.autoReadingMethod===e},on:{click:function(i){return t.setConfig("autoReadingMethod",e)}}},[t._v(t._s(e))])})),0)]),"像素滚动"===t.config.autoReadingMethod?i("li",[i("span",{staticClass:"setting-item-title"},[t._v("滚动像素")]),i("div",{staticClass:"resize"},[i("span",{staticClass:"less",on:{click:function(e){return t.decConfig("autoReadingPixel")}}},[i("i",{staticClass:"el-icon-minus"})]),i("b"),i("span",{staticClass:"lang"},[i("el-input",{staticClass:"setting-input",attrs:{size:"mini"},model:{value:t.config.autoReadingPixel,callback:function(e){t.$set(t.config,"autoReadingPixel",e)},expression:"config.autoReadingPixel"}})],1),i("b"),i("span",{staticClass:"less",on:{click:function(e){return t.incConfig("autoReadingPixel")}}},[i("i",{staticClass:"el-icon-plus"})])])]):t._e(),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("翻页速度")]),i("div",{staticClass:"resize"},[i("span",{staticClass:"less",on:{click:function(e){return t.decConfig("autoReadingLineTime")}}},[i("i",{staticClass:"el-icon-minus"})]),i("b"),i("span",{staticClass:"lang"},[i("el-input",{staticClass:"setting-input",attrs:{size:"mini"},model:{value:t.config.autoReadingLineTime,callback:function(e){t.$set(t.config,"autoReadingLineTime",e)},expression:"config.autoReadingLineTime"}})],1),i("b"),i("span",{staticClass:"less",on:{click:function(e){return t.incConfig("autoReadingLineTime")}}},[i("i",{staticClass:"el-icon-plus"})])])]),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("全屏点击")]),i("div",{staticClass:"selection-zone"},t._l(t.clickMethods,(function(e,o){return i("span",{key:o,staticClass:"span-item",class:{selected:t.config.clickMethod==e},on:{click:function(i){return t.setConfig("clickMethod",e)}}},[t._v(t._s(e))])})),0)]),i("li",[i("span",{staticClass:"setting-item-title"},[t._v("选择文字")]),i("div",{staticClass:"selection-zone"},t._l(t.selectionActions,(function(e,o){return i("span",{key:o,staticClass:"span-item",class:{selected:t.config.selectionAction==e},on:{click:function(i){return t.setConfig("selectionAction",e)}}},[t._v(t._s(e))])})),0)]),i("el-divider"),i("li",{staticClass:"operation-zone"},[i("span",{staticClass:"span-btn",on:{click:t.showClickZone}},[t._v("显示翻页区域")]),i("span",{staticClass:"span-btn",on:{click:t.showRuleEditor}},[t._v("过滤规则管理")])])],1)])])},$=[],x=(i("caad"),i("2532"),i("a434"),i("bfff")),y=i("8552"),T=i("7513"),B=i("63f0"),P={name:"ReadSettings",data:function(){return{themeColors:[{background:"rgba(250, 245, 235, 0.8)"},{background:"rgba(245, 234, 204, 0.8)"},{background:"rgba(230, 242, 230, 0.8)"},{background:"rgba(228, 241, 245, 0.8)"},{background:"rgba(245, 228, 228, 0.8)"},{background:"rgba(224, 224, 224, 0.8)"},{background:"rgba(0, 0, 0, 0.5)"},{background:"rgba(255, 255, 255, 0.8)"}],builtinBG:[{src:"bg/山水画.jpg"},{src:"bg/山水墨影.jpg"},{src:"bg/羊皮纸1.jpg"},{src:"bg/护眼漫绿.jpg"},{src:"bg/羊皮纸2.jpg"},{src:"bg/新羊皮纸.jpg"},{src:"bg/羊皮纸3.jpg"},{src:"bg/明媚倾城.jpg"},{src:"bg/羊皮纸4.jpg"},{src:"bg/深宫魅影.jpg"},{src:"bg/午后沙滩.jpg"},{src:"bg/清新时光.jpg"},{src:"bg/宁静夜色.jpg"},{src:"bg/边彩画布.jpg"}],fonts:["系统","黑体","楷体","宋体","仿宋"],readMethods:["上下滑动","左右滑动","上下滚动","上下滚动2"],clickMethods:["下一页","自动","不翻页"],selectionActions:["操作弹窗","忽略"],pageModes:["自适应","手机模式"],pageTypes:["正常","Kindle"],themeTypes:["day","night"],configDefaultTypeList:["白天默认","黑夜默认"],autoReadingMethods:["像素滚动","段落滚动"],chineseFonts:["简体","繁体"],customFontName:"",customFonts:x["a"],config:this.$store.state.config,configRules:{fontSize:{min:8,delta:1},fontWeight:{min:100,max:900,delta:100},animateMSTime:{min:0,max:500,delta:50},autoReadingPixel:{min:1,delta:5},autoReadingLineTime:{min:10,delta:50},lineHeight:{min:1,max:5,delta:.2},paragraphSpace:{min:0,max:5,delta:.2},readWidth:{min:160*Math.min(Math.floor(window.innerWidth/160),4),max:160*Math.floor(window.innerWidth/160),delta:160},horizontalPadding:{min:0,delta:1},topPadding:{min:0,delta:1},bottomPadding:{min:0,delta:1}}}},mounted:function(){this.config=Object(u["a"])(Object(u["a"])(Object(u["a"])({},x["b"].config),this.config),{},{selectionAction:"过滤弹窗"===this.$store.state.config.selectionAction?"操作弹窗":"忽略"})},computed:{moonIcon:function(){return this.$store.getters.isSystemNight?"":""},popupTheme:function(){return{background:this.$store.getters.currentThemeConfig.popup}},currentCustomConfig:function(){var t=this;return this.$store.state.customConfigList.find((function(e){return e.name===t.$store.state.config.customConfig}))}},watch:{config:{deep:!0,handler:function(t){this.$store.commit("setConfig",Object(u["a"])({},t))}}},methods:{setPageType:function(t){if(t!==this.config.pageType){var e={};"Kindle"===t?(Object(B["b"])("lastNormalConfig",this.config),e=Object(B["a"])("lastKindleConfig"),e=e||{animateMSTime:0,fontSize:Math.min(this.fontSize,20),theme:7,readMethod:"左右滑动",selectionAction:"忽略",pageMode:"手机模式"}):(Object(B["b"])("lastKindleConfig",this.config),e=Object(B["a"])("lastNormalConfig")||{}),this.config=Object(u["a"])(Object(u["a"])(Object(u["a"])({},this.config),e||{}),{},{pageType:t}),this.$emit("readMethodChange"),this.$emit("pageModeChange"),"手机模式"===this.config.pageMode?this.$store.commit("setMiniInterface",!0):this.$store.commit("setMiniInterface",Object(T["e"])())}},setPageMode:function(t){this.$emit("pageModeChange"),this.config=Object(u["a"])(Object(u["a"])({},this.config),{},{pageMode:t}),"手机模式"===this.config.pageMode?this.$store.commit("setMiniInterface",!0):this.$store.commit("setMiniInterface",Object(T["e"])())},setReadMethod:function(t){this.$emit("readMethodChange"),this.config=Object(u["a"])(Object(u["a"])({},this.config),{},{readMethod:t})},setConfig:function(t,e){var i={};i[t]=e,this.config=Object(u["a"])(Object(u["a"])({},this.config),i)},setAutoTheme:function(){this.config=Object(u["a"])(Object(u["a"])({},this.config),{},{autoTheme:!this.config.autoTheme})},incConfig:function(t){var e={},i=this.configRules[t],o=+this.config[t];e[t]="max"in i?Math.min(i.max,o+i.delta):o+i.delta,this.config=Object(u["a"])(Object(u["a"])({},this.config),e)},decConfig:function(t){var e={},i=this.configRules[t],o=+this.config[t];e[t]="min"in i?Math.max(i.min,o-i.delta):o-i.delta,this.config=Object(u["a"])(Object(u["a"])({},this.config),e)},getCustomBGImgURL:function(t){return this.api.replace(/\/reader3\/?/,"")+t},setBGImg:function(t){var e=Object(u["a"])({},this.config);e.contentBGImg===t?delete e.contentBGImg:e.contentBGImg=t,this.config=e},uploadBGFile:function(){this.$refs.bgFileRef.dispatchEvent(new MouseEvent("click"))},onBGFileChange:function(t){var e=this,i=t.target.files&&t.target.files[0],o=new FormData;o.append("file",i),o.append("type","background"),p["a"].post(this.api+"/uploadFile",o,{headers:{"Content-Type":"multipart/form-data"}}).then((function(t){if(t.data.isSuccess){if(!t.data.data.length)return void e.$message.error("上传文件失败");var i=Object(u["a"])({},e.config);i.customBGImgList=i.customBGImgList||[],i.customBGImgList.includes(t.data.data[0])||i.customBGImgList.push(t.data.data[0]),i.contentBGImg=t.data.data[0],e.config=i}}),(function(t){e.$message.error("上传文件失败 "+(t&&t.toString()))})),this.$refs.bgFileRef.value=null},uploadFontFile:function(t,e){var i=this;return Object(h["a"])(Object(l["a"])().mark((function o(){var n;return Object(l["a"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(!i.config.customFontsMap||!i.config.customFontsMap[t]){o.next=9;break}return o.next=3,i.$confirm("已上传自定义的".concat(e,"字体?"),"提示",{confirmButtonText:"继续上传",cancelButtonText:"恢复默认",type:"warning",closeOnClickModal:!1,closeOnPressEscape:!1,distinguishCancelAndClose:!0})["catch"]((function(t){return"close"===t&&"close"}));case 3:if(n=o.sent,"close"!==n){o.next=6;break}return o.abrupt("return");case 6:if(n){o.next=9;break}return p["a"].post(i.api+"/deleteFile",{url:i.config.customFontsMap[t]}).then((function(e){if(e.data.isSuccess){var o=Object(u["a"])({},i.config);delete o.customFontsMap[t],i.config=o,Object(T["h"])(t)}}),(function(t){i.$message.error("删除自定义字体文件失败 "+(t&&t.toString()))})),o.abrupt("return");case 9:i.customFontName=t,i.$refs.fontFileRef.dispatchEvent(new MouseEvent("click"));case 11:case"end":return o.stop()}}),o)})))()},onFontFileChange:function(t){var e=this,i=t.target.files&&t.target.files[0];if(i.name.toLowerCase().endsWith(".ttf")){var o=new FormData;o.append("file",i),o.append("type","fonts"),p["a"].post(this.api+"/uploadFile",o,{headers:{"Content-Type":"multipart/form-data"}}).then((function(t){if(t.data.isSuccess){if(!t.data.data.length)return void e.$message.error("上传文件失败");var i=Object(u["a"])({},e.config);i.customFontsMap=i.customFontsMap||{},i.customFontsMap[e.customFontName]=t.data.data[0],e.config=i}}),(function(t){e.$message.error("上传文件失败 "+(t&&t.toString()))})),this.$refs.fontFileRef.value=null}else this.$message.error("只支持 TTF 字体文件")},deleteCustomBGImg:function(t){var e=this;p["a"].post(this.api+"/deleteFile",{url:t}).then((function(i){if(i.data.isSuccess){var o=Object(u["a"])({},e.config);o.customBGImgList=o.customBGImgList||[];var n=o.customBGImgList.indexOf(t);-1!=n&&o.customBGImgList.splice(n,1),o.contentBGImg===t&&(o.contentBGImg=e.builtinBG[0].src),e.config=o}}),(function(t){e.$message.error("删除文件失败 "+(t&&t.toString()))}))},resetConfig:function(){this.config=Object(u["a"])({},x["b"].config)},showClickZone:function(){this.$emit("close"),this.$emit("showClickZone")},showRuleEditor:function(){this.$emit("close"),y["a"].$emit("showReplaceRuleDialog")},addNewCustomConfig:function(){var t=this;return Object(h["a"])(Object(l["a"])().mark((function e(){var i,o,n,s;return Object(l["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$prompt("请输入方案名称","添加配置方案",{inputValue:"",confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:function(t){return!!t||"方案名不能为空"}})["catch"]((function(){return!1}));case 2:if(i=e.sent,i){e.next=5;break}return e.abrupt("return");case 5:if(o=i.value.replace(/^\s+/,"").replace(/\s+$/,""),o){e.next=8;break}return e.abrupt("return","方案名不能为空");case 8:if(n=t.$store.state.customConfigList.find((function(t){return t.name===o})),!n){e.next=11;break}return e.abrupt("return","方案名不能重复");case 11:s=Object(u["a"])({},t.$store.state.customConfigList[0]),s.name=o,t.$store.commit("setCustomConfigList",[].concat(t.$store.state.customConfigList).concat([s]));case 14:case"end":return e.stop()}}),e)})))()},setCustomConfig:function(t){this.config=Object(u["a"])(Object(u["a"])({},this.config),{},{customConfig:t.name},t)},deleteCustomConfig:function(t,e){var i=this;return Object(h["a"])(Object(l["a"])().mark((function o(){var n,s;return Object(l["a"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(n=[].concat(i.$store.state.customConfigList),!(t<=1)){o.next=4;break}return i.$message.error("内置方案不能删除"),o.abrupt("return");case 4:if(!(n.length<=t)){o.next=7;break}return i.$message.error("方案不存在"),o.abrupt("return");case 7:if(i.$store.state.config.customConfig!==e){o.next=10;break}return i.$message.error("方案正在使用，无法删除"),o.abrupt("return");case 10:return o.next=12,i.$confirm("确认要删除".concat(e,"方案吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})["catch"]((function(){return!1}));case 12:if(s=o.sent,s){o.next=15;break}return o.abrupt("return");case 15:n.splice(t,1),i.$store.commit("setCustomConfigList",[].concat(n));case 17:case"end":return o.stop()}}),o)})))()},setConfigDefaultType:function(t){var e=this;return Object(h["a"])(Object(l["a"])().mark((function i(){var o,n;return Object(l["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,e.$confirm("确认要设置当前方案为".concat(t,"吗？继续操作将替换现有的").concat(t,"方案"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})["catch"]((function(){return!1}));case 2:if(o=i.sent,o){i.next=5;break}return i.abrupt("return");case 5:n=[].concat(e.$store.state.customConfigList),n.forEach((function(i){i.name===e.$store.state.config.customConfig?i.configDefaultType=t:i.configDefaultType===t&&(i.configDefaultType="")})),e.$store.commit("setCustomConfigList",n);case 8:case"end":return i.stop()}}),i)})))()}}},_=P,R=(i("095a"),i("4998"),Object(b["a"])(_,S,$,!1,null,"5c59289c",null)),M=R.exports,I=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"popup-wrapper",style:t.popupTheme},[i("div",{staticClass:"title-zone"},[i("div",{staticClass:"title"},[t._v("来源("+t._s(t.bookSource.length)+")")]),i("div",{class:{"title-btn":!0,loading:t.loadingMore}},[i("el-select",{staticClass:"booksource-group-select",attrs:{size:"mini",filterable:"",placeholder:"全部分组"},model:{value:t.bookSourceGroup,callback:function(e){t.bookSourceGroup=e},expression:"bookSourceGroup"}},t._l(t.$store.getters.bookSourceGroupList,(function(t,e){return i("el-option",{key:"source-group-"+e,attrs:{label:t.name+" ("+t.count+")",value:t.value}})})),1),i("span",{class:{loading:t.loading},on:{click:t.refresh}},[t.loading?i("i",{staticClass:"el-icon-loading"}):t._e(),t._v(" "+t._s(t.loading?"刷新中...":"刷新")+" ")]),i("span",{class:{loading:t.loadingMore},on:{click:t.searchBookSourceByEventStream}},[t.loadingMore?i("i",{staticClass:"el-icon-loading"}):t._e(),t._v(" "+t._s(t.loadingMore?"加载中...":"加载更多")+" ")])],1)]),i("div",{ref:"sourceList",staticClass:"data-wrapper",class:{night:t.$store.getters.isNight,day:!t.$store.getters.isNight}},[i("div",{staticClass:"source-list"},t._l(t.bookSource,(function(e,o){return i("div",{key:o,ref:"source",refInFor:!0,staticClass:"source-item",class:{selected:t.isSelected(e)},on:{click:function(i){return t.changeBookSource(e)}}},[i("div",{staticClass:"source-title"},[i("div",{staticClass:"source-name"},[t._v(" "+t._s(e.originName)+" ")]),i("div",{staticClass:"source-time"},[t._v(" "+t._s(e.time?"⏱ "+e.time+"ms":"")+" ")])]),i("div",{staticClass:"source-latest-chapter"},[t._v(" "+t._s(e.latestChapterTitle||"无最新章节")+" ")])])})),0)])])},L=[],O=(i("13d5"),i("45fc"),i("30b5")),j={name:"BookSource",data:function(){return{index:this.$store.getters.readingBook.index,bookSource:[],bookSourceGroup:"",bookSourceGroupIndexMap:{},loading:!1,loadingMore:!1}},props:["visible"],computed:{theme:function(){return this.$store.getters.config.theme},popupTheme:function(){return{background:this.$store.getters.currentThemeConfig.popup}},bookSourceMap:function(){return this.bookSource.reduce((function(t,e){return t[e.bookUrl]=e,t}),{})},readingBook:function(){return this.$store.getters.readingBook||{}}},mounted:function(){},watch:{visible:function(t){t&&this.getBookSource()},readingBook:function(t,e){t.bookUrl!==e.bookUrl&&(this.bookSourceGroupIndexMap={})}},methods:{isSelected:function(t){return t.bookUrl==this.$store.getters.readingBook.bookUrl},getBookSource:function(t){var e=this;p["a"].post(this.api+"/getAvailableBookSource",{url:this.$store.getters.readingBook.bookUrl,refresh:t?1:0}).then((function(t){var i;(e.loading=!1,t.data.isSuccess)&&(e.bookSource=t.data.data||[],e.bookSource.length&&(e.bookSourceGroupIndexMap[""]=Math.max(null!==(i=e.bookSourceGroupIndexMap[""])&&void 0!==i?i:0,e.bookSource.length),e.jumpToActive()))}),(function(t){throw e.loading=!1,e.$message.error("获取书籍来源信息失败 "+(t&&t.toString())),t}))},changeBookSource:function(t){var e=this;return Object(h["a"])(Object(l["a"])().mark((function i(){var o;return Object(l["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,e.$root.$children[0].isInShelf(e.$store.getters.readingBook,"加入书架之后才能切换书源, 是否加入书架?");case 2:if(o=i.sent,o){i.next=5;break}return i.abrupt("return");case 5:p["a"].post(e.api+"/setBookSource",{bookUrl:e.$store.getters.readingBook.bookUrl,newUrl:t.bookUrl,bookSourceUrl:t.origin}).then((function(i){if(i.data.isSuccess){e.$message.info("换源成功");var o=Object.assign({},e.$store.getters.readingBook);o.bookUrl=t.bookUrl,o.type="undefined"!==typeof t.type?t.type:o.type,o.coverUrl="undefined"!==typeof t.coverUrl?t.coverUrl:o.coverUrl,e.$store.commit("setReadingBook",o),e.$emit("changeBookSource"),p["a"].get(e.api+"/getBookshelf",{}).then((function(t){t.data.isSuccess&&e.$store.commit("setShelfBooks",t.data.data)}),(function(){}))}}),(function(t){throw e.$message.error("换源失败 "+(t&&t.toString())),t}));case 6:case"end":return i.stop()}}),i)})))()},refresh:function(){this.loadingMore||(this.loading=!0,this.getBookSource(!0))},loadMoreSource:function(){var t=this;this.loadingMore||(this.loadingMore=!0,p["a"].post(this.api+"/searchBookSource",{url:this.$store.getters.readingBook.bookUrl,bookSourceGroup:this.bookSourceGroup,lastIndex:this.bookSourceGroupIndexMap[this.bookSourceGroup]}).then((function(e){if(t.loadingMore=!1,e.data.isSuccess){var i=e.data.data.list||[];t.bookSource=[].concat(t.bookSource,i.filter((function(e){return!t.bookSourceMap[e.bookUrl]}))),e.data.data.lastIndex&&(t.bookSourceGroupIndexMap[t.bookSourceGroup]=e.data.data.lastIndex)}}),(function(e){throw t.loadingMore=!1,t.$message.error("加载更多书籍来源失败 "+(e&&e.toString())),e})))},searchBookSourceByEventStream:function(){var t=this,e=function(){try{t.searchEventSource&&t.searchEventSource.readyState!=t.searchEventSource.CLOSED&&t.searchEventSource.close(),t.searchEventSource=null}catch(e){}};if(this.loadingMore)return e(),void(this.loadingMore=!1);var i={accessToken:this.$store.state.token,concurrentCount:this.$store.state.searchConfig.concurrentCount,url:this.$store.getters.readingBook.bookUrl,bookSourceGroup:this.bookSourceGroup,lastIndex:this.bookSourceGroupIndexMap[this.bookSourceGroup]};this.loadingMore=!0;var o=O(this.api+"/searchBookSourceSSE",i);e(),this.searchEventSource=new EventSource(o,{withCredentials:!0}),this.searchEventSource.addEventListener("error",(function(i){t.loadingMore=!1,e();try{if(i.data){var o=JSON.parse(i.data);o&&o.errorMsg&&t.$message.error(o.errorMsg)}}catch(n){}}));var n=this.bookSource.length;this.searchEventSource.addEventListener("end",(function(i){t.loadingMore=!1,e();try{if(i.data){var o=JSON.parse(i.data);o&&o.lastIndex&&(t.bookSourceGroupIndexMap[t.bookSourceGroup]=o.lastIndex)}t.bookSource.length===n&&t.$message.error("没有更多啦")}catch(s){}})),this.searchEventSource.addEventListener("message",(function(e){try{if(e.data){var i=JSON.parse(e.data);i&&i.lastIndex&&(t.bookSourceGroupIndexMap[t.bookSourceGroup]=i.lastIndex),i.data&&(t.bookSource=[].concat(t.bookSource,i.data.filter((function(e){return!t.bookSourceMap[e.bookUrl]}))))}}catch(o){}}))},jumpToActive:function(){var t=this;this.$nextTick((function(){var e=-1;if(t.bookSource.some((function(i,o){if(i.bookUrl==t.$store.getters.readingBook.bookUrl)return e=o,!0})),!(e<0)){var i=t.$refs.sourceList;Object(f["a"])(t.$refs.source[e],{container:i,duration:0})}}))}}},z=j,E=(i("987b"),Object(b["a"])(z,I,L,!1,null,"72184148",null)),A=E.exports,N=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"popup-wrapper",style:t.popupTheme},[i("div",{staticClass:"title-zone"},[i("div",{staticClass:"title"},[t._v("书架("+t._s(t.shelfBooks.length)+")")]),i("div",{class:{"title-btn":!0,loading:t.refreshLoading}},[i("span",{class:{loading:t.refreshLoading},on:{click:t.refreshShelf}},[t.refreshLoading?i("i",{staticClass:"el-icon-loading"}):t._e(),t._v(" "+t._s(t.refreshLoading?"刷新中...":"刷新")+" ")])])]),i("div",{ref:"bookList",staticClass:"data-wrapper",class:{night:t.$store.getters.isNight,day:!t.$store.getters.isNight}},[i("div",{staticClass:"shelfbook-list"},t._l(t.shelfBooks,(function(e){return i("div",{key:e.bookUrl,ref:"book",refInFor:!0,staticClass:"book-item",class:{selected:t.isSelected(e)},on:{click:function(i){return t.changeBook(e)}}},[i("div",{staticClass:"book-title"},[i("div",{staticClass:"book-name"},[t._v(" "+t._s(e.name)+" ")]),e.totalChapterNum-1-e.durChapterIndex?i("div",{staticClass:"book-progress"},[t._v(" "+t._s(e.totalChapterNum-1-e.durChapterIndex)+" ")]):t._e()]),i("div",{staticClass:"chapter-text"},[t._v(" "+t._s(e.durChapterTitle)+" ")])])})),0)])])},F=[],U={name:"BookShelf",data:function(){return{refreshLoading:!1}},props:["visible"],computed:{theme:function(){return this.$store.getters.config.theme},popupTheme:function(){return{background:this.$store.getters.currentThemeConfig.popup}},shelfBooks:function(){return this.$store.getters.shelfBooks}},mounted:function(){},watch:{visible:function(t){t&&this.getBookshelf()}},methods:{isSelected:function(t){return t.bookUrl==this.$store.getters.readingBook.bookUrl},getBookshelf:function(t){var e=this;this.shelfBooks.length||Object(T["g"])((function(){return p["a"].get(e.api+"/getBookshelf",{params:{refresh:t?1:0}})}),"getBookshelf"+((this.$store.state.userInfo||{}).username||"default")).then((function(t){e.refreshLoading=!1,t.data.isSuccess&&(e.$store.commit("setShelfBooks",t.data.data),e.shelfBooks.length&&e.jumpToActive())}),(function(t){throw e.refreshLoading=!1,e.$message.error("获取书架书籍失败 "+(t&&t.toString())),t}))},changeBook:function(t){var e,i,o={name:t.name,bookUrl:t.bookUrl,index:null!==(e=null!==(i=t.index)&&void 0!==i?i:t.durChapterIndex)&&void 0!==e?e:0,type:t.type,coverUrl:t.customCoverUrl||t.coverUrl,tocUrl:t.tocUrl,author:t.author,origin:t.origin,originName:t.originName,latestChapterTitle:t.latestChapterTitle,intro:t.intro};this.$emit("changeBook",o)},refreshShelf:function(){this.refreshLoading||(this.refreshLoading=!0,this.getBookshelf(!0))},jumpToActive:function(){var t=this;this.$nextTick((function(){var e=-1;if(t.shelfBooks.some((function(i,o){if(i.bookUrl==t.$store.getters.readingBook.bookUrl)return e=o,!0})),!(e<0))if(t.$refs.book&&t.$refs.book[e]){var i=t.$refs.bookList;Object(f["a"])(t.$refs.book[e],{container:i,duration:0})}else setTimeout((function(){t.jumpToActive()}),10)}))},backToHome:function(){this.$emit("toShelf")}}},V=U,D=(i("873c"),Object(b["a"])(V,N,F,!1,null,"7f0b4e72",null)),W=D.exports,G=(i("e9c4"),{name:"ShadowIframe",data:function(){return{html:""}},computed:{contentWindow:function(){return this.$refs.iframe&&this.$refs.iframe.contentWindow}},props:["src","iframeStyle"],render:function(){return this.fallback()},mounted:function(){return Object(h["a"])(Object(l["a"])().mark((function t(){return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))()},methods:{checkShadowDom:function(){},fallback:function(){var t=this.$createElement;return t("iframe",{class:"epub-iframe",ref:"iframe",style:this.iframeStyle,attrs:{src:this.src}})}}}),H=G,X=Object(b["a"])(H,o,n,!1,null,"33520740",null),q=X.exports,Z={name:"Content",data:function(){return{currentTime:0,audioDuration:0,playing:!1,currentSpeed:1,audioVolume:100,startTime:0,iframeStyle:{}}},components:{ShadowIframe:q},props:["content","error","title","showContent","isScrollRead","showChapterList","currentShowChapter"],render:function(){var t=this,e=arguments[0];if(this.showContent){if(this.$store.getters.currentChapter&&this.$store.getters.currentChapter.isVolume)return e("div",{class:"content-body chapter-content reading-chapter volume-chapter",style:this.containerStyle},[e("div",{class:"volume-content"},[e("h3",{attrs:{"data-pos":0}},[this.title]),e("p",{class:"volume-tag"},[this.content])])]);if(this.isAudio)return this.renderAudio();if(this.isEpub)return this.renderEpub();if(this.isScrollRead)return this.renderScrollChapterList();var i=this.title.length+2;return e("div",{class:"content-body chapter-content reading-chapter",style:this.containerStyle,directives:[{name:"lazy-container",value:{selector:"img"}}]},[this.isCbz?null:e("h3",{attrs:{"data-pos":0}},[this.title]),this.content.split(/\n+/).map((function(o){if(o=o.replace(/^\s+/g,""),!o)return null;var n=i;return i+=o.length+2,o.indexOf("<img")>=0?(o=o.replace(/src=/g,"data-src=").replace("__API_ROOT__",t.$store.getters.apiRoot),e("div",{style:t.containerStyle,domProps:{innerHTML:o},attrs:{"data-pos":n}})):e("p",{style:t.pStyle,domProps:{innerHTML:o},attrs:{"data-pos":n}})}))])}return e("div")},mounted:function(){this.isAudio?this.play(!0):this.isEpub&&this.initIframe(),window.contentCom=this,this.loadCustomFontFamil()},computed:{readingBook:function(){return this.$store.getters.readingBook},chapter:function(){return this.$store.getters.readingBook.catalog[this.$store.getters.readingBook.index]||{}},show:function(){return this.$store.state.showContent},fontSize:function(){return this.$store.getters.config.fontSize+"px"},autoPlay:{get:function(){return this.$store.state.autoPlay},set:function(t){this.$store.commit("setAutoPlay",t)}},isCarToon:function(){return!this.error&&!this.isEpub&&(this.content||"").indexOf("<img")>=0},isAudio:function(){return!this.error&&1===this.readingBook.type},isEpub:function(){return!this.error&&this.readingBook.bookUrl.toLowerCase().endsWith(".epub")},isCbz:function(){return!this.error&&this.readingBook.bookUrl.toLowerCase().endsWith(".cbz")},containerStyle:function(){return Object(u["a"])(Object(u["a"])({fontSize:this.$store.getters.config.fontSize+"px",fontWeight:this.$store.getters.config.fontWeight||void 0,color:this.$store.getters.config.fontColor||(this.$store.getters.isNight?"#666":"#262626")},this.$store.getters.currentFontFamily),this.$store.getters.config.contentCSS||{})},pStyle:function(){return{lineHeight:this.$store.getters.config.lineHeight,marginTop:"undefined"!==typeof this.$store.getters.config.paragraphSpace?this.$store.getters.config.paragraphSpace+"em":null,marginBottom:"undefined"!==typeof this.$store.getters.config.paragraphSpace?this.$store.getters.config.paragraphSpace+"em":null}},windowSize:function(){return this.$store.state.windowSize},currentCustomFontFamily:function(){return this.$store.getters.currentCustomFontFamily}},watch:{containerStyle:function(){this.isEpub&&this.setIframeStyle()},pStyle:function(){this.isEpub&&this.setIframeStyle()},windowSize:function(){this.isEpub},currentCustomFontFamily:function(){this.loadCustomFontFamil()}},methods:{renderScrollChapterList:function(){var t=this,e=this.$createElement;return e("div",{class:"content-body",style:this.containerStyle,directives:[{name:"lazy-container",value:{selector:"img"}}]},[this.showChapterList.map((function(i){if(i.isVolume)return e("div",{class:"content-body chapter-content reading-chapter volume-chapter"},[e("div",{class:"volume-content"},[e("h3",{attrs:{"data-pos":0}},[i.title]),e("p",{class:"volume-tag"},[i.content])])]);var o=i.title.length+2;return e("div",{class:["chapter-content",t.readingBook.index===i.index?"reading-chapter":""],attrs:{"data-index":i.index}},[t.isCbz?null:e("h3",{attrs:{"data-pos":0}},[i.title]),i.content.split(/\n+/).map((function(i){if(i=i.replace(/^\s+/g,""),!i)return null;var n=o;return o+=i.length+2,i.indexOf("<img")>=0?(i=i.replace(/src=/g,"data-src=").replace("__API_ROOT__",t.$store.getters.apiRoot),e("div",{style:t.containerStyle,domProps:{innerHTML:i},attrs:{"data-pos":n}})):e("p",{style:t.pStyle,domProps:{innerHTML:i},attrs:{"data-pos":n}})}))])}))])},renderAudio:function(){var t=this,e=this.$createElement;return e("div",{class:"content-audio"},[e("audio",{ref:"audio",attrs:{preload:"preload",src:this.content},on:{loadMetaData:this.audioEvent,progress:this.onProgress,playing:this.onProgress,timeupdate:this.onTimeupdate,play:this.onPlay,pause:this.onPause,ended:this.onEnd,error:this.onError,seeked:this.onSeeked,seeking:this.onSeeking,stalled:this.audioEvent,suspend:this.onsuspend,loadeddata:this.audioEvent,loadedmetadata:this.audioEvent,canplay:this.onCanPlay,canplaythrough:this.audioEvent,waiting:this.onWaiting}}),e("div",{class:"book-cover"},[e("img",{directives:[{name:"lazy",value:this.getCover(this.readingBook.coverUrl)}]})]),e("div",{class:"book-progress"},[e("div",{class:"progress-tip"},[this.formatTime(this.currentTime)]),e("div",{class:"progress-container"},[e("el-slider",{attrs:{min:0,max:this.audioDuration,"show-tooltip":!1},model:{value:t.currentTime,callback:function(e){t.currentTime=e}},on:{change:function(e){t.seekTime(e)}}})]),e("div",{class:"progress-tip total-time"},[this.formatTime(this.audioDuration)])]),e("div",{class:"book-operation"},[e("i",{class:"reader-iconfont reader-icon-jian15s",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),function(){t.seekTime(t.$refs.audio.currentTime-15)}()}}}),e("i",{class:"reader-iconfont reader-icon-player-backward-step",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.prevChapter(e)}}}),e("i",{class:["reader-iconfont",this.playing?"reader-icon-player-play":"reader-icon-player-pause"],on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.toggle(e)}}}),e("i",{class:"reader-iconfont reader-icon-player-forward-step",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.nextChapter(e)}}}),e("i",{class:"reader-iconfont reader-icon-15s",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),function(){t.seekTime(t.$refs.audio.currentTime+15)}()}}})]),e("div",{class:"book-operation"},[e("span",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},[e("i",{class:["reader-iconfont",this.audioVolume>0?"reader-icon-volume":"reader-icon-volume-off"],style:{marginRight:this.audioVolume>0?"15px":"25px"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),function(){t.setAudioVolume(t.audioVolume>0?0:100)}()}}}),e("el-slider",{attrs:{min:0,max:100,"show-tooltip":!1},style:{width:"180px"},model:{value:t.audioVolume,callback:function(e){t.audioVolume=e}},on:{change:function(e){t.setAudioVolume(e)}}})])]),e("div",{class:"book-info",style:{background:this.getCover(this.readingBook.coverUrl,!0)}},[e("div",{class:"book-cover"},[e("img",{directives:[{name:"lazy",value:this.getCover(this.readingBook.coverUrl)}]})]),e("div",{class:"book-intro"},[e("div",{class:"title"},[this.title]),e("div",{class:"subtitle"},[this.readingBook.name,this.readingBook.author?"•":"",this.readingBook.author])])])])},renderEpub:function(){var t=this.$createElement,e=this.content;return e.startsWith("/")||(e="/"+e),t(q,{class:"epub-iframe",ref:"iframe",style:this.iframeStyle,attrs:{src:this.$store.getters.apiRoot+e}})},initIframe:function(){var t=this;window.addEventListener("message",(function(e){if(t.$refs.iframe&&e.source===t.$refs.iframe.contentWindow){var i;try{i=JSON.parse(e.data)}catch(o){return}"inited"===i.event?(t.iframeStyle={},t.setIframeStyle(),t.syncIframeHeight()):"load"===i.event?setTimeout((function(){t.$emit("iframeLoad"),t.$emit("epubLocationChange",i.data)}),100):"setHeight"===i.event?(t.iframeStyle=Object(u["a"])(Object(u["a"])({},t.iframeStyle),{},{height:Math.max(i.data,.8*t.windowSize.height)+"px"}),t.$emit("contentChange")):"click"===i.event?t.$emit("epubClick",i.data):"clickHash"===i.event?t.$emit("epubClickHash",i.data):"keydown"===i.event?t.$emit("epubKeydown",i.data):"previewImageList"===i.event&&(t.$store.commit("setPreviewImageIndex",i.data.imageIndex),t.$store.commit("setPreviewImgList",i.data.imageList))}}))},syncIframeHeight:function(){this.sendToIframe("execute",{script:"reader_notify('setHeight', document.documentElement.scrollHeight || document.body.scrollHeight)"})},setIframeStyle:function(){var t="";for(var e in this.containerStyle)Object.hasOwnProperty.call(this.containerStyle,e)&&(t+=e.replace(/([A-Z])/g,(function(t){return"-"+t.toLowerCase()}))+":"+this.containerStyle[e]+" !important;");var i="";for(var o in this.pStyle)Object.hasOwnProperty.call(this.pStyle,o)&&(i+=o.replace(/([A-Z])/g,(function(t){return"-"+t.toLowerCase()}))+":"+this.pStyle[o]+" !important;");i+="font-family: "+this.containerStyle.fontFamily+" !important;",i+="font-size: "+this.containerStyle.fontSize+" !important;",i+="font-weight: "+this.containerStyle.fontWeight+" !important;",i+="color: "+this.containerStyle.color+" !important;",this.sendToIframe("setStyle",{style:"\n        *::-webkit-scrollbar {\n          display: none;\n          width: 0 !important;\n          height: 0 !important;\n        }\n        *:focus {\n          outline: none !important;\n        }\n        html {\n          min-height: 100%;\n        }\n        body {\n          margin: 0 !important;\n          ".concat(t,"\n        }\n        body p {\n          ").concat(i,"\n        }\n        img {\n          display: block;\n          max-width: 100vw !important;\n          height: auto !important;\n        }")})},sendToIframe:function(t,e){var i=this;this.$refs.iframe?this.$refs.iframe&&this.$refs.iframe.contentWindow&&this.$refs.iframe.contentWindow.postMessage(JSON.stringify(Object(u["a"])({event:t},e)),"*"):setTimeout((function(){i.sendToIframe(t,e)}),10)},formatTime:function(t){if(!t)return"00:00";var e=function(t){return t>=10?""+t:"0"+t};if(t<60)return"00:"+e(t);if(t<3600){var i=Math.round(t/60),o=t%60;return e(i)+":"+e(o)}var n=Math.round(t/3600),s=Math.round(t/3600/60),a=t%60;return e(n)+":"+e(s)+":"+e(a)},seekTime:function(t){isNaN(t)||t===1/0||this.$refs.audio&&(this.$refs.audio.currentTime=t)},setAudioVolume:function(t){isNaN(t)||t===1/0||(this.audioVolume=t,this.$refs.audio&&(this.$refs.audio.volume=t/100))},ensureSeekTime:function(t){this.startTime=t},toggle:function(){this.playing?this.$refs.audio&&this.$refs.audio.pause():this.play()},play:function(t){var e=this;this.$refs.audio?(t&&(this.$refs.audio.load(),this.computeDuration()),t&&!this.autoPlay||this.$refs.audio.play()):setTimeout((function(){e.play(t)}),10)},prevChapter:function(){this.autoPlay=!0,this.$emit("prevChapter")},nextChapter:function(){this.autoPlay=!0,this.$emit("nextChapter")},computeDuration:function(){var t=this;if(this.$refs.audio){var e=this.$refs.audio.duration;this.$refs.audio.readyState>=1&&!isNaN(e)&&e!==1/0&&e?(this.audioDuration=parseInt(e),this.$refs.audio.playbackRate=this.currentSpeed,this.$refs.audio.currentTime=this.startTime,this.autoPlay&&this.$refs.audio.play()):setTimeout((function(){t.computeDuration()}),50)}else setTimeout((function(){t.computeDuration()}),100)},onProgress:function(){},onTimeupdate:function(){this.$refs.audio&&(this.currentTime=0|this.$refs.audio.currentTime),this.$emit("updateProgress")},onPlay:function(){this.playing=!0},onPause:function(){this.playing=!1},onEnd:function(){this.playing=!1,this.currentTime=0,this.audioDuration=0,this.autoPlay=!0,this.$emit("nextChapter")},onError:function(t){this.$message.error(t.toString()),this.playing=!1},onSeeked:function(){},onSeeking:function(){},audioEvent:function(){},onsuspend:function(){},onCanPlay:function(){},onWaiting:function(){},loadCustomFontFamil:function(){this.currentCustomFontFamily&&Object(T["f"])(this.currentCustomFontFamily.name,this.currentCustomFontFamily.url)}}},K=Z,Y=(i("6212"),i("0954"),Object(b["a"])(K,s,a,!1,null,"93dd3548",null)),J=Y.exports;i("6eba");function Q(t){var e=Date.now();window.requestAnimationFrame((function i(){var o=(Date.now()-e)/t.duration;o>1&&(o=1);var n=t.timing(o);t.draw(n),o<1?window.requestAnimationFrame(i):t.onEnd&&t.onEnd()}))}window.requestAnimationFrame||(window.requestAnimationFrame=function(t){return setTimeout(t,1e3/60)}),Q.Timings={linear:function(t){return t},circle:function(t){return 1-Math.sin(Math.acos(t))},circle2:function(t){return 1-Math.pow(1-Math.pow(t,2),.5)},bounce:function(t){for(var e=0,i=1;e+=i,i/=2;)if(t>=(7-4*e)/11)return-Math.pow((11-6*e-11*t)/4,2)+Math.pow(i,2)},power:function(t,e){return Math.pow(e,t)},back:function(t,e){return Math.pow(e,2)*((t+1)*e-t)},elastic:function(t,e){return Math.pow(2,10*(e-1))*Math.cos(20*Math.PI*t/3*e)}},Q.Utils={makeEaseOut:function(t){return function(e){return 1-t(1-e)}},makeEaseInOut:function(t){return function(e){return e<.5?t(2*e)/2:1-t(2*(1-e))/2}}};var tt=Q,et="皑蔼碍爱翱袄奥坝罢摆败颁办绊帮绑镑谤剥饱宝报鲍辈贝钡狈备惫绷笔毕毙闭边编贬变辩辫鳖瘪濒滨宾摈饼拨钵铂驳卜补参蚕残惭惨灿苍舱仓沧厕侧册测层诧搀掺蝉馋谗缠铲产阐颤场尝长偿肠厂畅钞车彻尘陈衬撑称惩诚骋痴迟驰耻齿炽冲虫宠畴踌筹绸丑橱厨锄雏础储触处传疮闯创锤纯绰辞词赐聪葱囱从丛凑窜错达带贷担单郸掸胆惮诞弹当挡党荡档捣岛祷导盗灯邓敌涤递缔点垫电淀钓调迭谍叠钉顶锭订东动栋冻斗犊独读赌镀锻断缎兑队对吨顿钝夺鹅额讹恶饿儿尔饵贰发罚阀珐矾钒烦范贩饭访纺飞废费纷坟奋愤粪丰枫锋风疯冯缝讽凤肤辐抚辅赋复负讣妇缚该钙盖干赶秆赣冈刚钢纲岗皋镐搁鸽阁铬个给龚宫巩贡钩沟构购够蛊顾剐关观馆惯贯广规硅归龟闺轨诡柜贵刽辊滚锅国过骇韩汉阂鹤贺横轰鸿红后壶护沪户哗华画划话怀坏欢环还缓换唤痪焕涣黄谎挥辉毁贿秽会烩汇讳诲绘荤浑伙获货祸击机积饥讥鸡绩缉极辑级挤几蓟剂济计记际继纪夹荚颊贾钾价驾歼监坚笺间艰缄茧检碱硷拣捡简俭减荐槛鉴践贱见键舰剑饯渐溅涧浆蒋桨奖讲酱胶浇骄娇搅铰矫侥脚饺缴绞轿较秸阶节茎惊经颈静镜径痉竞净纠厩旧驹举据锯惧剧鹃绢杰洁结诫届紧锦仅谨进晋烬尽劲荆觉决诀绝钧军骏开凯颗壳课垦恳抠库裤夸块侩宽矿旷况亏岿窥馈溃扩阔蜡腊莱来赖蓝栏拦篮阑兰澜谰揽览懒缆烂滥捞劳涝乐镭垒类泪篱离里鲤礼丽厉励砾历沥隶俩联莲连镰怜涟帘敛脸链恋炼练粮凉两辆谅疗辽镣猎临邻鳞凛赁龄铃凌灵岭领馏刘龙聋咙笼垄拢陇楼娄搂篓芦卢颅庐炉掳卤虏鲁赂禄录陆驴吕铝侣屡缕虑滤绿峦挛孪滦乱抡轮伦仑沦纶论萝罗逻锣箩骡骆络妈玛码蚂马骂吗买麦卖迈脉瞒馒蛮满谩猫锚铆贸么霉没镁门闷们锰梦谜弥觅绵缅庙灭悯闽鸣铭谬谋亩钠纳难挠脑恼闹馁腻撵捻酿鸟聂啮镊镍柠狞宁拧泞钮纽脓浓农疟诺欧鸥殴呕沤盘庞国爱赔喷鹏骗飘频贫苹凭评泼颇扑铺朴谱脐齐骑岂启气弃讫牵扦钎铅迁签谦钱钳潜浅谴堑枪呛墙蔷强抢锹桥乔侨翘窍窃钦亲轻氢倾顷请庆琼穷趋区躯驱龋颧权劝却鹊让饶扰绕热韧认纫荣绒软锐闰润洒萨鳃赛伞丧骚扫涩杀纱筛晒闪陕赡缮伤赏烧绍赊摄慑设绅审婶肾渗声绳胜圣师狮湿诗尸时蚀实识驶势释饰视试寿兽枢输书赎属术树竖数帅双谁税顺说硕烁丝饲耸怂颂讼诵擞苏诉肃虽绥岁孙损笋缩琐锁獭挞抬摊贪瘫滩坛谭谈叹汤烫涛绦腾誊锑题体屉条贴铁厅听烃铜统头图涂团颓蜕脱鸵驮驼椭洼袜弯湾顽万网韦违围为潍维苇伟伪纬谓卫温闻纹稳问瓮挝蜗涡窝呜钨乌诬无芜吴坞雾务误锡牺袭习铣戏细虾辖峡侠狭厦锨鲜纤咸贤衔闲显险现献县馅羡宪线厢镶乡详响项萧销晓啸蝎协挟携胁谐写泻谢锌衅兴汹锈绣虚嘘须许绪续轩悬选癣绚学勋询寻驯训讯逊压鸦鸭哑亚讶阉烟盐严颜阎艳厌砚彦谚验鸯杨扬疡阳痒养样瑶摇尧遥窑谣药爷页业叶医铱颐遗仪彝蚁艺亿忆义诣议谊译异绎荫阴银饮樱婴鹰应缨莹萤营荧蝇颖哟拥佣痈踊咏涌优忧邮铀犹游诱舆鱼渔娱与屿语吁御狱誉预驭鸳渊辕园员圆缘远愿约跃钥岳粤悦阅云郧匀陨运蕴酝晕韵杂灾载攒暂赞赃脏凿枣灶责择则泽贼赠扎札轧铡闸诈斋债毡盏斩辗崭栈战绽张涨帐账胀赵蛰辙锗这贞针侦诊镇阵挣睁狰帧郑证织职执纸挚掷帜质钟终种肿众诌轴皱昼骤猪诸诛烛瞩嘱贮铸筑驻专砖转赚桩庄装妆壮状锥赘坠缀谆浊兹资渍踪综总纵邹诅组钻致钟么为只凶准启板里雳余链泄",it="皚藹礙愛翺襖奧壩罷擺敗頒辦絆幫綁鎊謗剝飽寶報鮑輩貝鋇狽備憊繃筆畢斃閉邊編貶變辯辮鼈癟瀕濱賓擯餅撥缽鉑駁蔔補參蠶殘慚慘燦蒼艙倉滄廁側冊測層詫攙摻蟬饞讒纏鏟産闡顫場嘗長償腸廠暢鈔車徹塵陳襯撐稱懲誠騁癡遲馳恥齒熾沖蟲寵疇躊籌綢醜櫥廚鋤雛礎儲觸處傳瘡闖創錘純綽辭詞賜聰蔥囪從叢湊竄錯達帶貸擔單鄲撣膽憚誕彈當擋黨蕩檔搗島禱導盜燈鄧敵滌遞締點墊電澱釣調叠諜疊釘頂錠訂東動棟凍鬥犢獨讀賭鍍鍛斷緞兌隊對噸頓鈍奪鵝額訛惡餓兒爾餌貳發罰閥琺礬釩煩範販飯訪紡飛廢費紛墳奮憤糞豐楓鋒風瘋馮縫諷鳳膚輻撫輔賦複負訃婦縛該鈣蓋幹趕稈贛岡剛鋼綱崗臯鎬擱鴿閣鉻個給龔宮鞏貢鈎溝構購夠蠱顧剮關觀館慣貫廣規矽歸龜閨軌詭櫃貴劊輥滾鍋國過駭韓漢閡鶴賀橫轟鴻紅後壺護滬戶嘩華畫劃話懷壞歡環還緩換喚瘓煥渙黃謊揮輝毀賄穢會燴彙諱誨繪葷渾夥獲貨禍擊機積饑譏雞績緝極輯級擠幾薊劑濟計記際繼紀夾莢頰賈鉀價駕殲監堅箋間艱緘繭檢堿鹼揀撿簡儉減薦檻鑒踐賤見鍵艦劍餞漸濺澗漿蔣槳獎講醬膠澆驕嬌攪鉸矯僥腳餃繳絞轎較稭階節莖驚經頸靜鏡徑痙競淨糾廄舊駒舉據鋸懼劇鵑絹傑潔結誡屆緊錦僅謹進晉燼盡勁荊覺決訣絕鈞軍駿開凱顆殼課墾懇摳庫褲誇塊儈寬礦曠況虧巋窺饋潰擴闊蠟臘萊來賴藍欄攔籃闌蘭瀾讕攬覽懶纜爛濫撈勞澇樂鐳壘類淚籬離裏鯉禮麗厲勵礫曆瀝隸倆聯蓮連鐮憐漣簾斂臉鏈戀煉練糧涼兩輛諒療遼鐐獵臨鄰鱗凜賃齡鈴淩靈嶺領餾劉龍聾嚨籠壟攏隴樓婁摟簍蘆盧顱廬爐擄鹵虜魯賂祿錄陸驢呂鋁侶屢縷慮濾綠巒攣孿灤亂掄輪倫侖淪綸論蘿羅邏鑼籮騾駱絡媽瑪碼螞馬罵嗎買麥賣邁脈瞞饅蠻滿謾貓錨鉚貿麽黴沒鎂門悶們錳夢謎彌覓綿緬廟滅憫閩鳴銘謬謀畝鈉納難撓腦惱鬧餒膩攆撚釀鳥聶齧鑷鎳檸獰甯擰濘鈕紐膿濃農瘧諾歐鷗毆嘔漚盤龐國愛賠噴鵬騙飄頻貧蘋憑評潑頗撲鋪樸譜臍齊騎豈啓氣棄訖牽扡釺鉛遷簽謙錢鉗潛淺譴塹槍嗆牆薔強搶鍬橋喬僑翹竅竊欽親輕氫傾頃請慶瓊窮趨區軀驅齲顴權勸卻鵲讓饒擾繞熱韌認紉榮絨軟銳閏潤灑薩鰓賽傘喪騷掃澀殺紗篩曬閃陝贍繕傷賞燒紹賒攝懾設紳審嬸腎滲聲繩勝聖師獅濕詩屍時蝕實識駛勢釋飾視試壽獸樞輸書贖屬術樹豎數帥雙誰稅順說碩爍絲飼聳慫頌訟誦擻蘇訴肅雖綏歲孫損筍縮瑣鎖獺撻擡攤貪癱灘壇譚談歎湯燙濤縧騰謄銻題體屜條貼鐵廳聽烴銅統頭圖塗團頹蛻脫鴕馱駝橢窪襪彎灣頑萬網韋違圍爲濰維葦偉僞緯謂衛溫聞紋穩問甕撾蝸渦窩嗚鎢烏誣無蕪吳塢霧務誤錫犧襲習銑戲細蝦轄峽俠狹廈鍁鮮纖鹹賢銜閑顯險現獻縣餡羨憲線廂鑲鄉詳響項蕭銷曉嘯蠍協挾攜脅諧寫瀉謝鋅釁興洶鏽繡虛噓須許緒續軒懸選癬絢學勳詢尋馴訓訊遜壓鴉鴨啞亞訝閹煙鹽嚴顔閻豔厭硯彥諺驗鴦楊揚瘍陽癢養樣瑤搖堯遙窯謠藥爺頁業葉醫銥頤遺儀彜蟻藝億憶義詣議誼譯異繹蔭陰銀飲櫻嬰鷹應纓瑩螢營熒蠅穎喲擁傭癰踴詠湧優憂郵鈾猶遊誘輿魚漁娛與嶼語籲禦獄譽預馭鴛淵轅園員圓緣遠願約躍鑰嶽粵悅閱雲鄖勻隕運蘊醞暈韻雜災載攢暫贊贓髒鑿棗竈責擇則澤賊贈紮劄軋鍘閘詐齋債氈盞斬輾嶄棧戰綻張漲帳賬脹趙蟄轍鍺這貞針偵診鎮陣掙睜猙幀鄭證織職執紙摯擲幟質鍾終種腫衆謅軸皺晝驟豬諸誅燭矚囑貯鑄築駐專磚轉賺樁莊裝妝壯狀錐贅墜綴諄濁茲資漬蹤綜總縱鄒詛組鑽緻鐘麼為隻兇準啟闆裡靂餘鍊洩",ot=function(t){for(var e,i,o="",n=0;n<t.length;n++)i=t.charAt(n),i.charCodeAt(0)>1e4?(e=et.indexOf(i),o+=-1!=e?it.charAt(e):i):o+=i;return o},nt=function(t){for(var e,i,o="",n=0;n<t.length;n++)i=t.charAt(n),i.charCodeAt(0)>1e4?(e=it.indexOf(i),o+=-1!=e?et.charAt(e):i):o+=i;return o},st=/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&\(\)*+,-\./:;<=>?@\[\]^_`{\|}~，。？《》；：、«]/g,at={components:{PopCata:w,BookSource:A,BookShelf:W,Content:J,ReadSettings:M},mounted:function(){var t=this;window.readerPage=this,this.speechAvalable=window.speechSynthesis&&window.speechSynthesis.getVoices,this.speechAvalable&&(this.fetchVoiceList(),void 0!==window.speechSynthesis.onvoiceschanged&&(window.speechSynthesis.onvoiceschanged=this.fetchVoiceList)),window.addEventListener("unload",this.saveReadingPosition),y["a"].$on("showSearchContent",(function(e){if(!t._inactive)if(t.chapterIndex!==e.chapterIndex){if(t.isScrollRead)return t.scrollStartChapterIndex=e.chapterIndex,void t.computeShowChapterList().then((function(){t.showMatchKeyword(e)}));t.$once("showContent",(function(){t.showMatchKeyword(e)})),t.getContent(e.chapterIndex)}else t.showMatchKeyword(e)})),y["a"].$on("showBookmark",(function(e){if(!t._inactive)if(t.chapterIndex!==e.chapterIndex){if(t.isScrollRead)return t.scrollStartChapterIndex=e.chapterIndex,void t.computeShowChapterList().then((function(){t.showBookmark(e)}));t.$once("showContent",(function(){t.showBookmark(e)})),t.getContent(e.chapterIndex)}else t.showBookmark(e)}))},activated:function(){var t=this;this.init(),window.addEventListener("keydown",this.keydownHandler),this.title?document.title=this.$store.getters.readingBook.name+" - "+this.title:document.title=this.$store.getters.readingBook.name,this.formatTime(),this.timer=setInterval((function(){t.formatTime()}),5e3),this.unwatchFn=this.$store.watch((function(t){return t.config}),(function(){t.$nextTick((function(){t.computePages((function(){t.currentPage>t.totalPages&&t.showPage(t.totalPages,0)}))}))}),{deep:!0}),window.addEventListener("scroll",this.scrollHandler);try{this.releaseWakeLockFn=this.wakeLock()}catch(e){}this.$Lazyload.$on("loaded",this.lazyloadHandler)},deactivated:function(){this.saveBookProgress(),this.startSavePosition=!1,this.lastReadingBook=this.$store.getters.readingBook,this.timer&&clearInterval(this.timer),window.removeEventListener("keydown",this.keydownHandler),window.removeEventListener("scroll",this.scrollHandler),this.unwatchFn&&this.unwatchFn(),this.releaseWakeLockFn&&this.releaseWakeLockFn(),this.$Lazyload.$off("loaded",this.lazyloadHandler)},watch:{chapterName:function(t){this.title=t},content:function(){var t=this;this.contentStyle={},this.transformX=0,this.currentPage=1,this.$nextTick((function(){t.computePages(),t.saveReadingPosition()})),this.isEpub&&this.$once("iframeLoad",(function(){t.computePages()}))},readSettingsVisible:function(t){},title:function(t){document.title=t?this.$store.getters.readingBook.name+" - "+t:this.$store.getters.readingBook.name},isSlideRead:function(t){var e=this;t||(this.contentStyle={},this.transformX=0),this.$nextTick((function(){e.computePages((function(){e.currentParagraph?e.showParagraph(e.currentParagraph,!0):e.showPage(e.currentPage,0)}))}))},isScrollRead:function(t){t&&(this.scrollStartChapterIndex=this.chapterIndex,this.computeShowChapterList())},windowSize:function(){var t=this;this.$nextTick((function(){t.computePages((function(){t.showPage(t.currentPage,0)}))}))},loginAuth:function(t){t&&this.init(!0)},showReadBar:function(t){t&&(this.showToolBar=!1)},readingBook:function(t,e){t.bookUrl!==e.bookUrl&&(this.startSavePosition=!1,this.autoShowPosition())},currentPage:function(t,e){var i=this;t!==e&&t>=this.totalPages-2&&this.$store.getters.readingBook.index<this.$store.getters.readingBook.catalog.length-1&&(this.isScrollRead||this.preCaching||(this.preCaching=!0,this.getBookContent(this.$store.getters.readingBook.index+1,{timeout:3e4,silent:!0},!1,!0).then((function(){i.preCaching=!1}))))},filterRules:function(){this.isScrollRead?this.computeShowChapterList():this.content=this.filterContent(this.content)},chineseFont:function(){this.title=this.title,this.content=this.content,this.computeShowChapterList()}},data:function(){return{title:"",content:"",error:!1,popCataVisible:!1,readSettingsVisible:!1,popBookSourceVisible:!1,popBookShelfVisible:!1,showToolBar:!0,book:null,show:!1,contentStyle:{},currentPage:1,totalPages:1,transformX:0,transforming:!1,showLastPage:!1,showClickZone:!1,timeStr:"",progressValue:1,speechAvalable:!1,showReadBar:!1,voiceList:[],speechSpeaking:!1,showSpeechConfig:!0,currentParagraph:null,startSavePosition:!1,showCacheContentZone:!1,isCachingContent:!1,cachingContentTip:"",autoReading:!1,showChapterList:[],scrollStartChapterIndex:0,showNextChapterSize:1,showPrevChapterSize:0,speechMinutes:0,speechEndTime:0}},computed:{readingBook:function(){return this.$store.getters.readingBook||{}},catalog:function(){return(this.$store.getters.readingBook||{}).catalog||[]},chapterIndex:function(){return 0|((this.$store.getters.readingBook||{}).index||0)},windowSize:function(){return this.$store.state.windowSize},config:function(){return this.$store.getters.config},theme:function(){return this.config.theme},animateMSTime:function(){return this.config.animateMSTime},isNight:function(){return this.$store.getters.isNight},bodyTheme:function(){return{background:this.$store.getters.currentThemeConfig.body}},isSlideRead:function(){return!(this.autoReading||this.showReadBar||this.isEpub||this.isCarToon||this.isAudio)&&this.$store.getters.isSlideRead},isScrollRead:function(){return!this.isEpub&&!this.isAudio&&!this.isSlideRead&&("上下滚动"===this.config.readMethod||"上下滚动2"===this.config.readMethod)},chapterClass:function(){return this.isSlideRead?"slide-reader":this.isEpub?"epub":this.isCarToon?"cartoon":this.isAudio?"audio":""},chapterTheme:function(){var t=this.showReadBar?{paddingBottom:(this.showSpeechConfig?280:80)+"px"}:{};return"string"===typeof this.$store.getters.currentThemeConfig.content?Object(u["a"])(Object(u["a"])({},t),{},{background:this.$store.getters.currentThemeConfig.content,width:this.readWidth}):Object(u["a"])(Object(u["a"])(Object(u["a"])({},t),this.$store.getters.currentThemeConfig.content),{},{width:this.readWidth})},leftBarTheme:function(){return{background:this.$store.getters.currentThemeConfig.popup,marginLeft:this.$store.state.miniInterface?0:-(this.readWidthConfig/2+68)+"px",display:this.$store.state.miniInterface&&!this.showToolBar?"none":"block"}},rightBarTheme:function(){return{background:this.$store.getters.currentThemeConfig.popupPure,marginRight:this.$store.state.miniInterface?0:-(this.readWidthConfig/2+52)+"px",display:this.$store.state.miniInterface&&!this.showToolBar?"none":"block"}},readBarTheme:function(){return{background:this.$store.getters.currentThemeConfig.popupPure,marginRight:this.$store.state.miniInterface?0:-this.readWidthConfig/2+"px",zIndex:200,display:this.speechAvalable&&this.showReadBar?"block":"none",width:this.$store.state.miniInterface?"100vw":"500px"}},readWidth:function(){return this.$store.state.miniInterface?this.windowSize.width+"px":this.readWidthConfig-130+"px"},readWidthConfig:function(){var t=this.$store.getters.config.readWidth;while(t>this.$store.state.windowSize.width-140)t-=20;return t},popperWidth:function(){return this.$store.state.miniInterface?this.windowSize.width-33:this.readWidthConfig-33},readingProgress:function(){return this.catalog&&this.catalog.length?parseInt(100*(this.chapterIndex+1)/this.catalog.length)+"%":""},showPrevPageStyle:function(){return this.isSlideRead?{left:0,top:0,bottom:0,right:this.windowSize.width/2+"px",background:"#43987324",paddingRight:.2*this.windowSize.width+"px"}:{left:0,top:0,right:0,bottom:this.windowSize.height/2+"px",background:"#43987324"}},showMenuZoneStyle:function(){return{top:.3*this.windowSize.height+"px",bottom:.3*this.windowSize.height+"px",left:.3*this.windowSize.width+"px",right:.3*this.windowSize.width+"px",background:"#636060",zIndex:10}},showNextPageStyle:function(){return this.isSlideRead?{right:0,top:0,bottom:0,left:this.windowSize.width/2+"px",background:"#6b1a7324",paddingLeft:.2*this.windowSize.width+"px"}:{left:0,bottom:0,right:0,top:this.windowSize.height/2+"px",background:"#6b1a7324"}},loginAuth:function(){return this.$store.state.loginAuth},filterRules:function(){return this.$store.state.filterRules},themeBtnStyle:function(){return{background:this.$store.getters.currentThemeConfig.popupPure}},popupAbsoluteBtnStyle:function(){return{background:this.$store.getters.currentThemeConfig.popupPure}},voiceName:{get:function(){return this.$store.state.speechVoiceConfig.voiceName},set:function(t){t!==this.$store.state.speechVoiceConfig.voiceName&&this.speechSpeaking&&this.restartSpeech(),this.$store.commit("setSpeechVoiceConfig",Object(u["a"])(Object(u["a"])({},this.$store.state.speechVoiceConfig),{},{voiceName:t}))}},speechRate:{get:function(){return this.$store.state.speechVoiceConfig.speechRate},set:function(t){t!==this.$store.state.speechVoiceConfig.speechRate&&this.speechSpeaking&&this.restartSpeech(),this.$store.commit("setSpeechVoiceConfig",Object(u["a"])(Object(u["a"])({},this.$store.state.speechVoiceConfig),{},{speechRate:t}))}},speechPitch:{get:function(){return this.$store.state.speechVoiceConfig.speechPitch},set:function(t){t!==this.$store.state.speechVoiceConfig.speechPitch&&this.speechSpeaking&&this.restartSpeech(),this.$store.commit("setSpeechVoiceConfig",Object(u["a"])(Object(u["a"])({},this.$store.state.speechVoiceConfig),{},{speechPitch:t}))}},isCarToon:function(){return!this.error&&!this.isEpub&&!this.isCbz&&(this.content||"").indexOf("<img")>=0},isAudio:function(){return!this.error&&1===this.$store.getters.readingBook.type},isEpub:function(){return!this.error&&this.$store.getters.readingBook.bookUrl.toLowerCase().endsWith(".epub")},isCbz:function(){return!this.error&&this.$store.getters.readingBook.bookUrl.toLowerCase().endsWith(".cbz")},scrollOffset:function(){return this.$store.getters.config.fontSize*this.$store.getters.config.lineHeight*2+this.$store.getters.config.fontSize*this.$store.getters.config.paragraphSpace*2},formatedTitle:function(){return this.formatChinese(this.title)},chineseFont:function(){return this.config.chineseFont},slideDistance:function(){return 16+this.config.horizontalPadding}},methods:{init:function(t){var e=this;this.$store.getters.readingBook?t||!this.lastReadingBook||this.lastReadingBook.bookUrl!==this.$store.getters.readingBook.bookUrl?(this.title="",this.show=!1,this.loading=this.$loading({target:this.$refs.content,lock:!0,text:"正在获取内容",spinner:"el-icon-loading",background:"rgba(0,0,0,0)"}),this.lastReadingBook=this.$store.getters.readingBook,this.autoShowPosition(),this.loadCatalog(!1,!0)):(this.isScrollRead?(this.scrollStartChapterIndex=this.chapterIndex,this.showPrevChapterSize=0,this.computeShowChapterList().then((function(){e.autoShowPosition(!0)}))):this.isEpub?this.autoShowPosition(!0):this.startSavePosition=!0,setTimeout((function(){e.$store.commit("setReadingBook",e.lastReadingBook)}),100)):this.$message.error("请在书架选择书籍")},changeBook:function(t){this.$message.info("换书成功"),this.popBookShelfVisible=!1,this.show=!1,this.$store.commit("setReadingBook",t),this.loadCatalog(!0,!0)},changeBookSource:function(){this.popBookSourceVisible=!1,this.show=!1,this.tryRefresh=!1,this.loadCatalog(!0,!0)},loadCatalog:function(t,e){var i=this;this.api?this.getCatalog(t).then((function(t){if(t.data.isSuccess){var o=Object.assign({},i.$store.getters.readingBook);o.catalog=t.data.data,i.$store.commit("setReadingBook",o),i.$emit("loadCatalog");var n=o.index||0;i.getContent(n)}else e&&(i.title="",i.content="获取章节目录失败！\n"+t.data.errorMsg,i.error=!0,i.show=!0,i.$emit("showContent")),i.loading.close()}),(function(t){i.loading.close(),i.$message.error("获取书籍目录列表 "+(t&&t.toString()))})):setTimeout((function(){i.loadCatalog&&i.loadCatalog(t)}),1e3)},getCatalog:function(t){var e=this,i={url:this.$store.getters.readingBook.bookUrl,refresh:t?1:0};return this.$route.query.search&&(i.bookSourceUrl=this.$store.getters.readingBook.origin),Object(T["g"])((function(){return p["a"].post(e.api+"/getChapterList",i)}),this.$store.getters.readingBook.name+"_"+this.$store.getters.readingBook.author+"@"+this.$store.getters.readingBook.bookUrl+"@chapterList")},refreshCatalog:function(){return this.loadCatalog(!0)},getBookContent:function(t,e,i,o){return this.$root.$children[0].getBookContent(t,e,i,o)},refreshContent:function(){this.getContent(this.$store.getters.readingBook.index,!0)},getContent:function(t,e){var i=this;this.show=!1,this.loading&&this.loading.visible||(this.loading=this.$loading({target:this.$refs.content,lock:!0,text:e?"正在刷新内容":"正在获取内容",spinner:"el-icon-loading",background:"rgba(0,0,0,0)"}));var o=this.$store.getters.readingBook.bookUrl;try{var n=Object(u["a"])({},this.$store.getters.readingBook);n.index=t,this.$store.commit("setReadingBook",n)}catch(c){console.error(c)}if(this.toTop(0),this.$store.getters.readingBook.catalog[t]){var s=this.$store.getters.readingBook.catalog[t].title,a=this.$store.getters.readingBook.catalog[t].index;this.title=s;var r=(new Date).getTime();this.getBookContent(a,{},e).then((function(e){if(o===i.$store.getters.readingBook.bookUrl&&t===i.$store.getters.readingBook.index){if(r+100>(new Date).getTime()&&i.saveBookProgress(),e.data.isSuccess){var n=e.data.data;i.content=i.filterContent(n),i.addChapterContentToCache({bookUrl:o,index:t,title:s,content:e.data.data,error:!1}),i.loading.close(),i.error=!1,i.show=!0,i.$emit("showContent")}else i.content="获取章节内容失败！\n"+e.data.errorMsg,i.addChapterContentToCache({bookUrl:o,index:t,title:s,content:"获取章节内容失败！\n"+e.data.errorMsg,error:!0}),i.error=!0,i.show=!0,i.$emit("showContent"),i.loading.close();i.isScrollRead&&i.computeShowChapterList()}}),(function(e){if(o===i.$store.getters.readingBook.bookUrl&&t===i.$store.getters.readingBook.index)throw i.content="获取章节内容失败！\n"+(e&&e.toString()),i.addChapterContentToCache({bookUrl:o,index:t,title:s,content:"获取章节内容失败！\n"+(e&&e.toString()),error:!0}),i.error=!0,i.show=!0,i.$emit("showContent"),i.loading.close(),i.$message.error("获取章节内容失败 "+(e&&e.toString())),i.isScrollRead&&i.computeShowChapterList(),e}))}else this.tryRefresh?(this.tryRefresh=!1,this.content="获取章节内容失败，请更新目录！",this.error=!0,this.show=!0,this.$emit("showContent"),this.loading.close()):(this.tryRefresh=!0,this.refreshCatalog())},filterContent:function(t){var e=this;if(this.isEpub||this.isAudio)return t;if(!t)return t;try{this.filterRules.forEach((function(i){if("undefined"===typeof i.isEnabled||!1!==i.isEnabled){var o=i.scope.split(";");"*"!==o[0]&&o[0]!==e.$store.getters.readingBook.name||(1==o.length||o.length>1&&o[1]===e.$store.getters.readingBook.bookUrl)&&(t=i.isRegex?t.replace(new RegExp(i.pattern,"ig"),i.replacement):t.replace(i.pattern,i.replacement))}}))}catch(i){}return t.replace(/\\n+/g,"\n"),t=this.formatChinese(t),t},loadShowChapter:function(t,e){var i=this;if(!e&&this.chapterContentCache&&this.chapterContentCache.chapters[t]&&!this.chapterContentCache.chapters[t].error)return t>=this.chapterIndex-this.showPrevChapterSize&&t<=this.chapterIndex+this.showNextChapterSize&&this.computeShowChapterList(),Promise.resolve();var o=this.$store.getters.readingBook.bookUrl;if(!this.$store.getters.readingBook.catalog)return new Promise((function(o){i.$once("loadCatalog",(function(){i.loadShowChapter(t,e).then(o)}))}));if(!this.$store.getters.readingBook.catalog[t])return Promise.reject("章节不存在");var n=this.$store.getters.readingBook.catalog[t].title,s=this.$store.getters.readingBook.catalog[t].index;return this.getBookContent(s,{},e,!0).then((function(e){e.data.isSuccess?i.addChapterContentToCache({bookUrl:o,index:t,title:n,content:e.data.data,error:!1}):i.addChapterContentToCache({bookUrl:o,index:t,title:n,content:"获取章节内容失败！\n"+e.data.errorMsg,error:!0})}),(function(e){throw i.addChapterContentToCache({bookUrl:o,index:t,title:n,content:"获取章节内容失败！\n"+(e&&e.toString()),error:!0}),e}))},addChapterContentToCache:function(t){this.chapterContentCache&&this.chapterContentCache.bookUrl===this.readingBook.bookUrl||(this.chapterContentCache={bookUrl:this.readingBook.bookUrl,chapters:{}}),"undefined"!==typeof this.chapterContentCache.chapters[t.index]&&t.error&&!this.chapterContentCache.chapters[t.index].error||(t.isVolume=!!(this.readingBook.catalog[t.index]||{}).isVolume,this.chapterContentCache.chapters[t.index]=t)},computeShowChapterList:function(t){var e=this;if(!this.chapterContentCache)return new Promise((function(i){setTimeout((function(){e.computeShowChapterList(t).then(i)}),10)}));if(!this.isScrollRead)return Promise.resolve();var i=[],o=this.scrollStartChapterIndex||this.chapterIndex;"上下滚动2"===this.config.readMethod&&(o=this.chapterIndex-this.showPrevChapterSize);for(var n=[],s=o;s<=this.chapterIndex+this.showNextChapterSize;s++)this.chapterContentCache.chapters[s]?i.push(Object(u["a"])(Object(u["a"])({},this.chapterContentCache.chapters[s]),{},{content:this.filterContent(this.chapterContentCache.chapters[s].content)})):n.push(this.loadShowChapter(s));if(n.length)return Promise.all(n).then((function(){e.computeShowChapterList(t)}));this.saveReadingPosition(),this.startSavePosition=!1,this.showChapterList=i,this.$nextTick((function(){e.computePages((function(){t?(e.toTop(0),e.startSavePosition=!0):"上下滚动2"===e.config.readMethod?e.autoShowPosition(!0):e.startSavePosition=!0}))}))},saveBookProgress:function(){return p["a"].post(this.api+"/saveBookProgress",{url:this.$store.getters.readingBook.bookUrl,index:this.chapterIndex},{silent:!0})["catch"]((function(){}))},toTop:function(t){this.$store.state.miniInterface?this.scrollContent(-(document.documentElement.scrollTop||document.body.scrollTop),t):Object(f["a"])(this.$refs.top,{duration:t})},toBottom:function(t){Object(f["a"])(this.$refs.bottom,{duration:t})},toNextChapter:function(t){if(this.$store.getters.readingBook&&this.$store.getters.readingBook.bookUrl&&this.$store.getters.readingBook.catalog){var e=this.$store.getters.readingBook.index;if(e++,"undefined"!==typeof this.$store.getters.readingBook.catalog[e]){if(this.isScrollRead)return this.scrollStartChapterIndex=e,void this.computeShowChapterList(!0);this.getContent(e)}else t&&t(),this.$message.error("本章是最后一章")}else t&&t()},toLastChapter:function(t){if(this.$store.getters.readingBook&&this.$store.getters.readingBook.bookUrl&&this.$store.getters.readingBook.catalog){var e=this.$store.getters.readingBook.index;if(e--,"undefined"!==typeof this.$store.getters.readingBook.catalog[e]){if(this.isScrollRead)return this.scrollStartChapterIndex=e,void this.computeShowChapterList(!0);this.getContent(e)}else this.$message.error("本章是第一章"),t&&t()}else t&&t()},toShelf:function(){this.$router.push("/")},computePages:function(t){var e=this;this.$refs.bookContentRef&&this.$refs.bookContentRef.$el?(this.isSlideRead?this.totalPages=Math.ceil(this.$refs.bookContentRef.$el.scrollWidth/(this.windowSize.width-this.slideDistance)):this.totalPages=Math.ceil(this.$refs.bookContentRef.$el.scrollHeight/(this.windowSize.height-this.scrollOffset)),this.showLastPage&&(this.showPage(this.totalPages,0),this.showLastPage=!1),t&&t()):setTimeout((function(){e.computePages(t)}),30)},nextPage:function(t){var e=this;if(this.show&&!this.transforming)if(this.isSlideRead)this.currentPage<this.totalPages?("undefined"===typeof t&&(this.transformX=-(this.windowSize.width-this.slideDistance)*(this.currentPage-1)),this.currentPage+=1,this.transforming=!0,this.transform("undefined"===typeof t?-(this.windowSize.width-this.slideDistance):t,this.animateMSTime)):this.toNextChapter((function(){"undefined"!==typeof t&&e.showPage(e.currentPage,0)}));else if((document.documentElement.scrollTop||document.body.scrollTop)+this.windowSize.height<document.documentElement.scrollHeight){this.currentPage+=1;var i=this.windowSize.height-this.scrollOffset;this.transforming=!0,this.scrollContent(i,this.animateMSTime)}else this.currentPage=1,this.toNextChapter()},prevPage:function(t){var e=this;if(this.show&&!this.transforming)if(this.isSlideRead)this.currentPage>1?("undefined"===typeof t&&(this.transformX=-(this.windowSize.width-this.slideDistance)*(this.currentPage-1)),this.currentPage-=1,this.transforming=!0,this.transform("undefined"===typeof t?this.windowSize.width-this.slideDistance:t,this.animateMSTime)):(this.showLastPage=!0,this.toLastChapter((function(){"undefined"!==typeof t&&e.showPage(e.currentPage,0)})));else if((document.documentElement.scrollTop||document.body.scrollTop)>0){this.currentPage-=1;var i=-this.windowSize.height+this.scrollOffset;this.transforming=!0,this.scrollContent(i,this.animateMSTime)}else this.currentPage=1,this.toLastChapter()},showPage:function(t,e){if(this.show)if(this.currentPage=Math.min(t,this.totalPages),this.isSlideRead){var i=-(this.windowSize.width-this.slideDistance)*(this.currentPage-1)-this.transformX;this.transform(i,"undefined"===typeof e?this.animateMSTime:e)}else{var o=(this.windowSize.height-10)*(this.currentPage-1)-(document.documentElement.scrollTop||document.body.scrollTop);this.scrollContent(o,"undefined"===typeof e?this.animateMSTime:e)}},transform:function(t,e){var i=this,o=function(){i.contentStyle={transform:"translateX(".concat(i.transformX+t,"px)")},i.transformX+=t,i.transforming=!1,setTimeout(i.saveReadingPosition,e)};if(e){var n=tt.Utils.makeEaseInOut(tt.Timings.power.bind(null,3));new tt({duration:e||500,timing:n,draw:function(e){i.contentStyle={transform:"translateX(".concat(i.transformX+t*e,"px)")}},onEnd:o})}else o()},scrollContent:function(t,e,i){var o=this,n=i?0:document.documentElement.scrollTop||document.body.scrollTop,s=function(){document.documentElement.scrollTop=n+t,document.body.scrollTop=n+t,o.transforming=!1,setTimeout(o.saveReadingPosition,e)};if(e){var a=tt.Utils.makeEaseInOut(tt.Timings.power.bind(null,3));new tt({duration:e||500,timing:a,draw:function(e){document.documentElement.scrollTop=n+t*e,document.body.scrollTop=n+t*e},onEnd:s})}else s()},handlerClick:function(t){this.isEpub||(this.lastTouch||this.ignoreNextClick||this.eventHandler(t),this.ignoreNextClick=!1)},handleTouchStart:function(t){this.lastSelection=this.checkSelection(),this.lastSelection||this.isAudio||this.isEpub||(this.lastTouch=!1,this.lastMoveX=!1,t.touches&&t.touches[0]&&(this.lastTouch=t.touches[0]))},handleTouchMove:function(t){if(!this.checkSelection()&&t.touches&&t.touches[0]&&this.lastTouch&&(this.lastMoveY=t.touches[0].clientY-this.lastTouch.clientY,this.isSlideRead)){t.preventDefault(),t.stopPropagation();var e=t.touches[0].clientX-this.lastTouch.clientX;this.contentStyle={transform:"translateX(".concat(this.transformX+e,"px)")},this.lastMoveX=e}},handleTouchEnd:function(){var t=this;this.checkSelection(!0)||(this.lastSelection?setTimeout((function(){t.showTextFilterPrompt(t.lastSelection),t.lastSelection=!1}),200):(this.lastMoveX?(this.transformX+=this.lastMoveX,this.lastMoveX>0?this.prevPage(this.windowSize.width-this.slideDistance-this.lastMoveX):this.nextPage(-(this.windowSize.width-this.slideDistance)-this.lastMoveX)):Math.abs(this.lastMoveY)<=3&&this.lastTouch&&this.eventHandler(this.lastTouch),setTimeout((function(){t.lastTouch=!1,t.lastMoveX=!1,t.lastMoveY=!1}),300)))},epubClickHash:function(t){"undefined"!==typeof t.top&&this.scrollContent(t.top-(this.$store.state.miniInterface?this.getFirstParagraphPos().bottom:0)-(0|window.webAppDistance)-(0|this.$store.state.safeArea.top),0,!0)},epubLocationChangeHandler:function(t){function e(t){var e=document.createElement("a");return e.href=t,decodeURIComponent(e.pathname)}t=e(t);var i=this.catalog[this.chapterIndex];if(i){for(var o=this.content.replace(i.url,""),n=t.replace(o,""),s=-1,a=0;a<this.catalog.length;a++)if(this.catalog[a].url===n){s=a;break}if(s>=0){var r=Object(u["a"])({},this.$store.getters.readingBook);r.index=s,this.$store.commit("setReadingBook",r),this.title=this.$store.getters.readingBook.catalog[s].title}}},eventHandler:function(t){if(this.checkSelection(!0))this.ignoreNextClick=!0;else if(this.popBookSourceVisible||this.popBookShelfVisible||this.popCataVisible||this.readSettingsVisible)this.isEpub&&(this.popBookSourceVisible=!1,this.popBookShelfVisible=!1,this.popCataVisible=!1,this.readSettingsVisible=!1);else if(this.isAudio)this.showReadBar||(this.showToolBar=!this.showToolBar);else if(this.autoReading)this.showToolBar=!this.showToolBar;else{var e=this.windowSize.width/2,i=this.windowSize.height/2;if(this.isEpub&&(t.clientY=t.clientY+45-(document.documentElement.scrollTop||document.body.scrollTop)),Math.abs(t.clientY-i)<=.2*this.windowSize.height&&Math.abs(t.clientX-e)<=.2*this.windowSize.width)this.showReadBar||(this.showToolBar=!this.showToolBar);else{if("下一页"===this.$store.getters.config.clickMethod)return this.showToolBar=!1,void this.nextPage();if("不翻页"===this.$store.getters.config.clickMethod)return void(this.showToolBar=!this.showToolBar);this.isSlideRead?t.clientX>e?(this.showToolBar=!1,this.nextPage()):t.clientX<e&&(this.showToolBar=!1,this.prevPage()):t.clientY>i?(this.showToolBar=!1,this.nextPage()):t.clientY<i&&(this.showToolBar=!1,this.prevPage())}}},keydownHandler:function(t,e){if(!(this.popBookSourceVisible||this.popBookShelfVisible||this.popCataVisible||this.readSettingsVisible||this.showTextFilterPrompting)&&(e||document.activeElement===document.body)&&!this.isAudio){var i={37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",27:"Escape"},o=t.key||i[t.keyCode];switch(o){case"ArrowLeft":t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),this.showToolBar=!1,this.isSlideRead?this.prevPage():this.toLastChapter();break;case"ArrowRight":t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),this.showToolBar=!1,this.isSlideRead?this.nextPage():this.toNextChapter();break;case"ArrowUp":t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),this.showToolBar=!1,this.prevPage();break;case"ArrowDown":t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),this.showToolBar=!1,this.nextPage();break;case"Escape":this.toShelf();break}}},formatProgressTip:function(t){return"第 ".concat(t||this.progressValue,"/").concat(this.totalPages," 页")},formatTime:function(){var t=new Date,e=function(t){return t>=10?""+t:"0"+t};this.timeStr=e(t.getHours())+":"+e(t.getMinutes())},checkSelection:function(t){var e=this,i="";return window.getSelection?i=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(i=document.selection.createRange().text),i&&t&&setTimeout((function(){"过滤弹窗"!==e.$store.getters.config.selectionAction&&"操作弹窗"!==e.$store.getters.config.selectionAction||e.showTextOperate(i)}),200),i},showTextOperate:function(t){var e=this;return Object(h["a"])(Object(l["a"])().mark((function i(){var o;return Object(l["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,e.$confirm("请选择操作?","提示",{confirmButtonText:"添加过滤规则",cancelButtonText:"添加书签",type:"warning",closeOnClickModal:!1,closeOnPressEscape:!1,distinguishCancelAndClose:!0})["catch"]((function(t){return"close"===t&&"close"}));case 2:if(o=i.sent,"close"!==o){i.next=5;break}return i.abrupt("return");case 5:if(!o){i.next=9;break}return i.abrupt("return",e.showTextFilterPrompt(t));case 9:return i.abrupt("return",e.showAddBookmark(t));case 10:case"end":return i.stop()}}),i)})))()},showTextFilterPrompt:function(t){var e=this;return Object(h["a"])(Object(l["a"])().mark((function i(){var o;return Object(l["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(!e.showTextFilterPrompting){i.next=2;break}return i.abrupt("return");case 2:if(t.replace(/^\s+/,"").replace(/\s+$/,"")){i.next=4;break}return i.abrupt("return");case 4:o=Object.assign({},x["d"],{name:"文本替换",pattern:t,replacement:"",isRegex:!1,isEnabled:!0,scope:e.$store.getters.readingBook.name+";"+e.$store.getters.readingBook.bookUrl}),e.showTextFilterPrompting=!0,y["a"].$emit("showReplaceRuleForm",o,!0,(function(){e.showTextFilterPrompting=!1}));case 7:case"end":return i.stop()}}),i)})))()},showAddBookmark:function(t){var e=this;return Object(h["a"])(Object(l["a"])().mark((function i(){var o,n,s,a,r,c,h,u,d,g;return Object(l["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(!e.showAddBookmarking){i.next=2;break}return i.abrupt("return");case 2:if(o=t.replace(/^\s+/,"").replace(/\s+$/,""),n=e.getContentMatchParagraph(o,1,.7),n){i.next=7;break}return e.$message.error("选择1-2段整段文字才能定位段落"),i.abrupt("return");case 7:if(s=5,a=150,r=[n],c=n.innerText+"\n",!(r.length<s&&c.length<a)){i.next=27;break}h=-1,u=e.$refs.bookContentRef.$el.querySelectorAll("h3,p"),d=0;case 15:if(!(d<u.length)){i.next=27;break}if(!(h>0&&d>h)){i.next=23;break}if(r.push(u[d]),c+=u[d].innerText+"\n",!(r.length>=s||c.length>=a)){i.next=21;break}return i.abrupt("break",27);case 21:i.next=24;break;case 23:r[r.length-1]===u[d]&&(h=d);case 24:d++,i.next=15;break;case 27:c=c.replace(/\\n*$/,""),g=Object.assign({},x["c"],{bookName:e.$store.getters.readingBook.name,bookAuthor:e.$store.getters.readingBook.author,chapterIndex:e.chapterIndex,chapterPos:e.currentPage,chapterName:e.title,bookText:c,content:""}),e.showAddBookmarking=!0,y["a"].$emit("showBookmarkForm",g,!0,(function(){e.showAddBookmarking=!1}));case 31:case"end":return i.stop()}}),i)})))()},toogleNight:function(){this.isNight?this.$store.commit("setNightTheme",!1):this.$store.commit("setNightTheme",!0)},fetchVoiceList:function(){this.voiceList=window.speechSynthesis.getVoices().sort((function(t,e){return t.lang.startsWith("zh-")&&e.lang.startsWith("zh-")?t.lang>e.lang?1:t.lang<e.lang?-1:0:t.lang.startsWith("zh-")?-1:e.lang.startsWith("zh-")||t.lang>e.lang?1:t.lang<e.lang?-1:0}))},changeSpeechRate:function(t){this.speechRate=t},changeSpeechPitch:function(t){this.speechPitch=t},changeSpeechMinutes:function(t){this.speechMinutes=t,this.speechEndTime=t?(new Date).getTime()+60*t*1e3:0},startSpeech:function(){var t=this;if(!this.error&&this.voiceName){var e=this.voiceList.find((function(e){return e.name===t.voiceName}));if(e&&!window.speechSynthesis.speaking)if(this.speechSpeaking&&this.speechEndTime>0&&(new Date).getTime()>this.speechEndTime)this.$message.info("定时关闭朗读");else{var i=this.getCurrentParagraph();i.innerText?(this.utterance=new SpeechSynthesisUtterance(i.innerText),this.utterance.onstart=function(){t.speechSpeaking=!0,t.skipAutoNext=!1},this.utterance.onend=function(){t.skipAutoNext?(t.skipAutoNext=!1,t.speechSpeaking=!1):t.speechNext()},this.utterance.onerror=function(e){(e.error||e.name)&&t.$message.error("朗读错误:  ".concat(e.type||"","  ").concat(e.error||e.name||e.toString())),t.speechSpeaking=window.speechSynthesis.speaking||!1},this.utterance.voice=e,this.utterance.pitch=this.speechPitch,this.utterance.rate=this.speechRate,this.showParagraph(i,!0),i.className="reading",this.speechSpeaking=!0,window.speechSynthesis.speak(this.utterance)):this.speechNext()}}},stopSpeech:function(t){try{if(this.skipAutoNext=!0,window.speechSynthesis.cancel(),t){var e=this.getCurrentParagraph();e&&(e.className="")}}catch(i){}},restartSpeech:function(){var t=this;this.stopSpeech(),setTimeout((function(){t.startSpeech()}),100)},toggleSpeech:function(){this.speechSpeaking?this.stopSpeech(!0):this.startSpeech()},speechPrev:function(){var t=this;window.speechSynthesis.speaking&&this.stopSpeech();var e=this.getCurrentParagraph(),i=this.getPrevParagraph();i?(this.showParagraph(i,!0),e.className="",i.className="reading",this.startSpeech()):(this.$once("showContent",(function(){setTimeout((function(){t.startSpeech()}),100)})),this.toLastChapter())},speechNext:function(){var t=this;window.speechSynthesis.speaking&&this.stopSpeech();var e=this.getCurrentParagraph(),i=this.getNextParagraph();i?(this.showParagraph(i,!0),e.className="",i.className="reading",this.startSpeech()):(this.$once("showContent",(function(){setTimeout((function(){t.startSpeech()}),100)})),this.toNextChapter())},getCurrentParagraph:function(){var t=this.$refs.bookContentRef.$el.querySelectorAll(".reading"),e=null;if(t.length)e=t[0];else for(var i=this.$refs.bookContentRef.$el.querySelectorAll("h3,p"),o=0;o<i.length;o++){var n=i[o].getBoundingClientRect();if(this.isSlideRead){if(n.right>0){e=i[o];break}}else if(n.bottom>50+(0|window.webAppDistance)+(0|this.$store.state.safeArea.top)){e=i[o];break}}return e},getPrevParagraph:function(){for(var t=this.getCurrentParagraph(),e=this.$refs.bookContentRef.$el.querySelectorAll("h3,p"),i=0;i<e.length;i++)if(i>0&&t===e[i])return e[i-1];return null},getNextParagraph:function(){for(var t=this.getCurrentParagraph(),e=this.$refs.bookContentRef.$el.querySelectorAll("h3,p"),i=0;i<e.length;i++)if(t===e[i])return e[i+1];return null},exitRead:function(){var t=this.getCurrentParagraph();this.stopSpeech(!0),this.showReadBar=!1,this.showParagraph(t)},showParagraph:function(t,e){var i=this;t&&(this.isSlideRead?this.$nextTick((function(){var e=t.getBoundingClientRect();e.left>i.windowSize.width-i.slideDistance&&i.showPage(Math.round(e.left/(i.windowSize.width-i.slideDistance))+1,0)})):e&&this.$nextTick((function(){var e=t.getBoundingClientRect();i.scrollContent(e.top-(i.$store.state.miniInterface?i.getFirstParagraphPos().bottom:0)-(0|window.webAppDistance)-(0|i.$store.state.safeArea.top),0)})))},getFirstParagraphPos:function(){return this.$refs.top.getBoundingClientRect()},scrollHandler:function(){var t=this,e=document.documentElement.scrollTop||document.body.scrollTop;if(this.isSlideRead||(this.currentPage=Math.round((e+this.windowSize.height)/(this.windowSize.height-this.scrollOffset))),this.isScrollRead){var i=this.lastScrollTop||0;if(i>0&&0==e);else if(e>document.documentElement.scrollHeight-2*this.windowSize.height&&!this.preCaching&&this.startSavePosition){this.preCaching=!0;var o=this.chapterIndex+1;this.showChapterList.length&&(o=this.showChapterList[this.showChapterList.length-1].index+1),this.showNextChapterSize=o-this.chapterIndex,this.loadShowChapter(o).then((function(){t.computeShowChapterList(),t.preCaching=!1}))["catch"]((function(){t.preCaching=!1}))}}this.lastScrollTop=e,this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(this.saveReadingPosition,100)},beforeReadMethodChange:function(){this.currentParagraph=this.getCurrentParagraph()},showPosition:function(t,e){var i=this;if(this.isAudio){if(!this.$refs.bookContentRef)return void setTimeout((function(){i.showPosition(t,e)}),10);this.$refs.bookContentRef.ensureSeekTime(t)}else if(this.isEpub||this.isCarToon)this.scrollContent(t,0,!0),this.isEpub&&this.$once("iframeLoad",(function(){i.scrollContent(t,0,!0),e&&e()}));else{if(!this.$refs.bookContentRef)return void setTimeout((function(){i.showPosition(t,e)}),10);for(var o=this.$refs.bookContentRef.$el.querySelectorAll(".reading-chapter h3,p"),n=0;n<o.length;n++)if(o[n].dataset&&"undefined"!==typeof o[n].dataset.pos&&+o[n].dataset.pos>=t){this.showParagraph(o[n],!0);break}e&&e()}},saveReadingPosition:function(){try{if(this.error||!this.startSavePosition)return;var t=0;if(this.isAudio)t=this.$refs.bookContentRef?this.$refs.bookContentRef.currentTime:0;else if(this.isEpub||this.isCarToon)t=document.documentElement.scrollTop||document.body.scrollTop;else{if(this.preCaching)return;if(this.currentParagraph=this.getCurrentParagraph(),this.currentParagraph){var e=this.currentParagraph;while(e.className.indexOf("chapter-content")<0)if(e=e.parentNode,e===this.$refs.bookContentRef.$el)break;if(e){if(e.dataset&&"undefined"!==typeof e.dataset.index){var i=+e.dataset.index;if(i!=this.$store.getters.readingBook.index){var o=Object(u["a"])({},this.$store.getters.readingBook);o.index=i,this.$store.commit("setReadingBook",o),this.saveBookProgress(),this.title=this.$store.getters.readingBook.catalog[i].title}}t=e.innerText.indexOf(this.currentParagraph.innerText)}}}Object(B["b"])("bookChapterProgress@"+this.$store.getters.readingBook.name+"_"+this.$store.getters.readingBook.author,t)}catch(n){}},autoShowPosition:function(t){var e=this,i=function(){if(setTimeout((function(){e.startSavePosition=!0}),2e3),!e.error){var t=Object(B["a"])("bookChapterProgress@"+e.$store.getters.readingBook.name+"_"+e.$store.getters.readingBook.author);t&&+t&&e.$nextTick((function(){e.showPosition(+t,(function(){e.startSavePosition=!0}))}))}};t?i():this.$once("showContent",i)},wakeLock:function(){if("WakeLock"in window&&"request"in window.WakeLock){var t=null,e=function(){var t=new AbortController,e=t.signal;return window.WakeLock.request("screen",{signal:e})["catch"]((function(t){t.name})),t};t=e();var i=function(){null!==t&&"visible"===document.visibilityState&&(t=e())};return document.addEventListener("visibilitychange",i),document.addEventListener("fullscreenchange",i),function(){null!=t&&(t.abort(),t=null),document.removeEventListener("visibilitychange",i),document.removeEventListener("fullscreenchange",i)}}if("wakeLock"in navigator&&"request"in navigator.wakeLock){var o=null,n=function(){var t=Object(h["a"])(Object(l["a"])().mark((function t(){return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.wakeLock.request("screen");case 3:o=t.sent,o.addEventListener("release",(function(){})),t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();n();var s=function(){null!==o&&"visible"===document.visibilityState&&n()};return document.addEventListener("visibilitychange",s),document.addEventListener("fullscreenchange",s),function(){null!=o&&(o.release(),o=null),document.removeEventListener("visibilitychange",s),document.removeEventListener("fullscreenchange",s)}}},lazyloadHandler:function(){this.isAudio||this.computePages()},showCacheContent:function(){this.showCacheContentZone=!this.showCacheContentZone},cacheChapterContent:function(t){var e=this,i=[];i=!0===t?i.concat(this.catalog.slice(this.chapterIndex+1,this.catalog.length)):i.concat(this.catalog.slice(this.chapterIndex+1,Math.min(this.catalog.length,this.chapterIndex+1+t))),i.length?(this.isCachingContent=!0,this.cachingContentTip="正在缓存章节  0/"+i.length,this.cachingHandler=Object(T["a"])(2,(function(t){e.cachingContentTip="正在缓存章节  "+t.requestCount+"/"+i.length,t.isEnd()&&(e.$message.success("缓存完成"),e.isCachingContent=!1,e.cachingContentTip="")})),i.forEach((function(t){e.cachingHandler((function(){return e.getBookContent(t.index,{timeout:3e4,silent:!0},!1,!0)}))}))):this.$message.error("不需要缓存")},cancelCaching:function(){this.cachingHandler&&this.cachingHandler.cancel&&(this.cachingHandler.cancel(),this.isCachingContent=!1,this.cachingContentTip="")},startAutoReading:function(){this.showToolBar=!1,this.autoReading=!0,this.autoRead()},autoRead:function(){var t=this;if(this.autoReading)if(this.showToolBar)this.autoReadingTimer=setTimeout((function(){t.autoRead()}),300);else if("像素滚动"!==this.config.autoReadingMethod){var e=this.getCurrentParagraph(),i=this.getNextParagraph();if(i){e.className="reading",i.className="";var o=this.config.autoReadingLineTime;try{var n=e.getBoundingClientRect();o*=Math.ceil(n.height/this.config.fontSize/this.config.lineHeight)}catch(s){}this.autoReadingTimer=setTimeout((function(){e.className="",i.className="reading",t.showParagraph(i,!0),setTimeout((function(){t.autoRead()}),32)}),o)}else this.$once("showContent",(function(){setTimeout((function(){t.autoRead()}),100)})),this.toNextChapter((function(){t.autoReading=!1}))}else this.autoReadByPixel()},autoReadByPixel:function(){var t=this;if(this.autoReading)if(this.showToolBar)this.autoReadingTimer=setTimeout((function(){t.autoRead()}),300);else if("像素滚动"===this.config.autoReadingMethod){var e=document.documentElement.scrollTop||document.body.scrollTop;e+this.windowSize.height<document.documentElement.scrollHeight?this.autoReadingTimer=setTimeout((function(){t.scrollContent(t.config.autoReadingPixel,0),t.autoReadByPixel()}),this.config.autoReadingLineTime):(this.$once("showContent",(function(){setTimeout((function(){t.autoReadByPixel()}),100)})),this.toNextChapter((function(){t.autoReading=!1})))}else this.autoRead()},stopAutoReading:function(){this.autoReadingTimer&&clearInterval(this.autoReadingTimer),this.autoReading=!1;var t=this.getCurrentParagraph();t.className=""},toggleAutoReading:function(){this.autoReading?this.stopAutoReading():this.startAutoReading()},showReadingBookInfo:function(){var t=Object(u["a"])({},this.$store.getters.readingBook),e=this.$store.getters.shelfBooks.find((function(e){return e.bookUrl===t.bookUrl}));t=Object.assign(t,e||{}),y["a"].$emit("showBookInfoDialog",t)},formatChinese:function(t){return this.isEpub||this.isAudio||this.isCbz||this.isCarToon?t:"简体"===this.config.chineseFont?nt(t):ot(t)},showSearchBookContentDialog:function(){var t=Object(u["a"])({},this.$store.getters.readingBook),e=this.$store.getters.shelfBooks.find((function(e){return e.bookUrl===t.bookUrl}));t=Object.assign(t,e||{}),y["a"].$emit("showSearchBookContentDialog",t)},showMatchKeyword:function(t){var e=this;if(!this._inactive)if(this.$refs.bookContentRef)try{for(var i=this.$refs.bookContentRef.$el.querySelectorAll(".reading-chapter h3,p"),o=0,n=0;n<i.length;n++){var s=i[n].innerText,a=-1,r=!1;while(1){if(a=s.indexOf(t.query,a+1),!(a>=0))break;if(o++,o===t.resultCountWithinChapter+1){r=!0,this.showParagraph(i[n],!0);break}}if(r)break}}catch(c){}else setTimeout((function(){e.showMatchKeyword(t)}),10)},getParagraphListInView:function(){for(var t=this.$refs.bookContentRef.$el.querySelectorAll("h3,p"),e=[],i=0;i<t.length;i++){var o=t[i].getBoundingClientRect();this.isSlideRead?o.right>0&&o.left>0&&e.push(t[i]):o.bottom>50+(0|window.webAppDistance)+(0|this.$store.state.safeArea.top)&&o.bottom<this.windowSize.height&&e.push(t[i])}return e},showBookmarkDialog:function(){var t=Object(u["a"])({},this.$store.getters.readingBook),e=this.$store.getters.shelfBooks.find((function(e){return e.bookUrl===t.bookUrl}));t=Object.assign(t,e||{}),y["a"].$emit("showBookmarkDialog",t)},getContentMatchParagraph:function(t,e,i){e=e||.7;var o=t.replace(/\\n+/g,"\n").split(/\n+/).map((function(t){return t.replace(st,"")})).filter((function(t){return t}));try{for(var n=this.$refs.bookContentRef.$el.querySelectorAll(".reading-chapter h3,p"),s=null,a=0;a<n.length;a++){for(var r=!0,c=0,l=a,h=0;h<o.length;h++){var u=null;while(a+c<n.length){if(u=n[a+c].innerText.replace(st,""),u.length)break;c++,l++}if(!u){r=!1;break}var d=Object(T["c"])(u,o[h]);if(d<e){r=!1;break}c++}if(r){s=n[l];break}}if(s)return s;if(e-.1>=i)return this.getContentMatchParagraph(t,e-.1,i)}catch(g){console.error(g)}return null},showContentMatchParagraph:function(t){if(!this._inactive){var e=this.getContentMatchParagraph(t,1,.6);e?this.showParagraph(e,!0):this.$message.error("无法定位内容所在段落")}},showBookmark:function(t){var e=this;this._inactive||(this.$refs.bookContentRef?this.showContentMatchParagraph(t.bookText):setTimeout((function(){e.showBookmark(t)}),10))}}},rt=at,ct=(i("a663"),i("48b1"),Object(b["a"])(rt,r,c,!1,null,"83b2ec9a",null));e["default"]=ct.exports},"987b":function(t,e,i){"use strict";i("ddc1")},a663:function(t,e,i){"use strict";i("320d")},a779:function(t,e,i){},b009:function(t,e,i){},be21:function(t,e,i){},ddc1:function(t,e,i){}}]);